<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://www.yzgc.top/Microservices/SpringCloud.html"><meta property="og:site_name" content="é²¨ç“œ"><meta property="og:title" content="SpringCloud"><meta property="og:description" content="SpringCloud æç¤º æœ¬æ–‡æ¡£åªè®²è§£å¾®æœåŠ¡çš„åŸºç¡€ä½¿ç”¨,æƒ³è¦äº†è§£æ·±å±‚æ¬¡çš„åŸç†è¯·è·³è¿‡ï¼Œé¿å…è€½è¯¯æ—¶é—´ï¼ï¼ æ‰€æœ‰ä»£ç å‡åœ¨GitHub,éœ€è¦è¯·è‡ªå– https://github.com/yangzhaoguang/cloud2024.git ç›®å‰å¸¸ç”¨çš„ç»„ä»¶ï¼š image-20240403150037397image-20240403150037397 ä¸€ã€..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-09T03:26:57.000Z"><meta property="article:author" content="é²¨ç“œ"><meta property="article:tag" content="SpringCloud"><meta property="article:tag" content="Consul"><meta property="article:tag" content="GateWay"><meta property="article:tag" content="ZipKin"><meta property="article:tag" content="OpenFeign"><meta property="article:tag" content="Resilience4J"><meta property="article:published_time" content="2024-03-28T00:00:00.000Z"><meta property="article:modified_time" content="2024-04-09T03:26:57.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SpringCloud","image":[""],"datePublished":"2024-03-28T00:00:00.000Z","dateModified":"2024-04-09T03:26:57.000Z","author":[{"@type":"Person","name":"é²¨ç“œ","url":"https://www.yzgc.top"}]}</script><title>SpringCloud | é²¨ç“œ</title><meta name="description" content="SpringCloud æç¤º æœ¬æ–‡æ¡£åªè®²è§£å¾®æœåŠ¡çš„åŸºç¡€ä½¿ç”¨,æƒ³è¦äº†è§£æ·±å±‚æ¬¡çš„åŸç†è¯·è·³è¿‡ï¼Œé¿å…è€½è¯¯æ—¶é—´ï¼ï¼ æ‰€æœ‰ä»£ç å‡åœ¨GitHub,éœ€è¦è¯·è‡ªå– https://github.com/yangzhaoguang/cloud2024.git ç›®å‰å¸¸ç”¨çš„ç»„ä»¶ï¼š image-20240403150037397image-20240403150037397 ä¸€ã€...">
    <link rel="stylesheet" href="/assets/css/styles.8b7644d8.css">
    <link rel="preload" href="/assets/js/runtime~app.c5243060.js" as="script"><link rel="preload" href="/assets/css/styles.8b7644d8.css" as="style"><link rel="preload" href="/assets/js/549.dd93fff4.js" as="script"><link rel="preload" href="/assets/js/app.37257e1e.js" as="script">
    <link rel="prefetch" href="/assets/js/SpringCloud.html.4b618c6a.js" as="script"><link rel="prefetch" href="/assets/js/SpringCloud Alibaba.html.1b1f0a61.js" as="script"><link rel="prefetch" href="/assets/js/waline.0c40e7d1.js" as="script"><link rel="prefetch" href="/assets/js/12æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨.html.6bd439ee.js" as="script"><link rel="prefetch" href="/assets/js/02SQL.html.6385c7c9.js" as="script"><link rel="prefetch" href="/assets/js/photo-swipe.7c292b9b.js" as="script"><link rel="prefetch" href="/assets/js/13ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–.html.9dc803f0.js" as="script"><link rel="prefetch" href="/assets/js/03å‡½æ•°.html.3cb91140.js" as="script"><link rel="prefetch" href="/assets/js/07çº¦æŸ.html.c4205e2b.js" as="script"><link rel="prefetch" href="/assets/js/16é”.html.e17c3d33.js" as="script"><link rel="prefetch" href="/assets/js/06MySQLä¸­çš„æ•°æ®ç±»å‹.html.4e2cdb49.js" as="script"><link rel="prefetch" href="/assets/js/04å­æŸ¥è¯¢.html.7e252c5b.js" as="script"><link rel="prefetch" href="/assets/js/09ç´¢å¼•.html.1c53584f.js" as="script"><link rel="prefetch" href="/assets/js/18æ—¥å¿—.html.e02b36cb.js" as="script"><link rel="prefetch" href="/assets/js/15äº‹åŠ¡.html.8ace5b61.js" as="script"><link rel="prefetch" href="/assets/js/index.html.5a04b1f6.js" as="script"><link rel="prefetch" href="/assets/js/19ä¸»ä»å¤åˆ¶.html.0b2468ec.js" as="script"><link rel="prefetch" href="/assets/js/10InnoDBæ•°æ®å­˜å‚¨ç»“æ„.html.c303cffe.js" as="script"><link rel="prefetch" href="/assets/js/17MVCC.html.de51f021.js" as="script"><link rel="prefetch" href="/assets/js/markdown.html.4409aa92.js" as="script"><link rel="prefetch" href="/assets/js/11ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™.html.ef9a7806.js" as="script"><link rel="prefetch" href="/assets/js/08MySQLæ¶æ„.html.5db4afc5.js" as="script"><link rel="prefetch" href="/assets/js/20å¤‡ä»½.html.03ca6596.js" as="script"><link rel="prefetch" href="/assets/js/05åˆ›å»ºå’Œç®¡ç†è¡¨.html.e65bf3f6.js" as="script"><link rel="prefetch" href="/assets/css/384.styles.38c3030c.css" as="style"><link rel="prefetch" href="/assets/js/01æ¦‚è¿°.html.25bf66b0.js" as="script"><link rel="prefetch" href="/assets/js/14æ•°æ®åº“çš„è®¾è®¡è§„èŒƒ.html.9715eb21.js" as="script"><link rel="prefetch" href="/assets/js/21é™„å½•.html.1bbe610e.js" as="script"><link rel="prefetch" href="/assets/js/355.0100446c.js" as="script"><link rel="prefetch" href="/assets/js/page.html.edcda7a9.js" as="script"><link rel="prefetch" href="/assets/js/layout.html.6084dabf.js" as="script"><link rel="prefetch" href="/assets/js/217_å­˜åœ¨é‡å¤å…ƒç´ .html.7fc73d92.js" as="script"><link rel="prefetch" href="/assets/js/disable.html.715eebf9.js" as="script"><link rel="prefetch" href="/assets/css/995.styles.514c94a6.css" as="style"><link rel="prefetch" href="/assets/js/encrypt.html.914dddeb.js" as="script"><link rel="prefetch" href="/assets/js/404.html.e94f121c.js" as="script"><link rel="prefetch" href="/assets/js/209.8d8ed17e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">é²¨ç“œ</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/LeetCode/" aria-label="LeetCode"><img class="icon" src="/assets/icon/leetcode.png" alt aria-hidden no-view style="">LeetCode<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/MySQL/" aria-label="MySQL"><img class="icon" src="/assets/icon/MySQL.png" alt aria-hidden no-view style="">MySQL<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Microservices"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-flex" style=""></span>Microservices</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link active" href="/Microservices/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Microservices/SpringCloud%20Alibaba.html" aria-label="SpringCloud Alibaba"><!---->SpringCloud Alibaba<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="icon" src="/assets/icon/microservices.png" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Microservices</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/Microservices/SpringCloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Microservices/SpringCloud%20Alibaba.html" aria-label="SpringCloud Alibaba"><!---->SpringCloud Alibaba<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->SpringCloud</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.yzgc.top" target="_blank" rel="noopener noreferrer">é²¨ç“œ</a></span><span property="author" content="é²¨ç“œ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-03-28T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 46 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT46M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category1 clickable" role="navigation">å¾®æœåŠ¡</span><!--]--><meta property="articleSection" content="å¾®æœåŠ¡"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag7 clickable" role="navigation">SpringCloud</span><span class="page-tag-item tag4 clickable" role="navigation">Consul</span><span class="page-tag-item tag1 clickable" role="navigation">GateWay</span><span class="page-tag-item tag2 clickable" role="navigation">ZipKin</span><span class="page-tag-item tag2 clickable" role="navigation">OpenFeign</span><span class="page-tag-item tag2 clickable" role="navigation">Resilience4J</span><!--]--><meta property="keywords" content="SpringCloud,Consul,GateWay,ZipKin,OpenFeign,Resilience4J"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#ä¸€ã€æ­å»ºç¤ºä¾‹é¡¹ç›®">ä¸€ã€æ­å»ºç¤ºä¾‹é¡¹ç›®</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-1-ç¯å¢ƒæ­å»º">1.1 ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-2-mapper4ä¸€é”®ç”Ÿæˆ">1.2 Mapper4ä¸€é”®ç”Ÿæˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-3-æ–°å»ºæ”¯ä»˜æ¨¡å—">1.3 æ–°å»ºæ”¯ä»˜æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-4-è§£å†³æ—¶é—´æ ¼å¼ã€åŒä¸€è¿”å›ç»“æœ">1.4 è§£å†³æ—¶é—´æ ¼å¼ã€åŒä¸€è¿”å›ç»“æœ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-5-å…¨å±€å¼‚å¸¸å¤„ç†">1.5 å…¨å±€å¼‚å¸¸å¤„ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-6-æ–°å»ºè®¢å•æ¨¡å—">1.6 æ–°å»ºè®¢å•æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1-7-ç›®å‰é¡¹ç›®å­˜åœ¨çš„é—®é¢˜">1.7 ç›®å‰é¡¹ç›®å­˜åœ¨çš„é—®é¢˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#äºŒã€consul">äºŒã€Consul</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-1-ä»‹ç»ã€å®‰è£…">2.1 ä»‹ç»ã€å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-2-æœåŠ¡æ³¨å†Œ">2.2 æœåŠ¡æ³¨å†Œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-3-å°é—®é¢˜">2.3 å°é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-4-åˆ†å¸ƒå¼é…ç½®">2.4 åˆ†å¸ƒå¼é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-5-åŠ¨æ€åˆ·æ–°">2.5 åŠ¨æ€åˆ·æ–°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2-6-é…ç½®æŒä¹…åŒ–">2.6 é…ç½®æŒä¹…åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#ä¸‰ã€æœåŠ¡è°ƒç”¨">ä¸‰ã€æœåŠ¡è°ƒç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_3-1-loadbalance">3.1 LoadBalance</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_3-2-openfeign">3.2 OpenFeign</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#å››ã€ç†”æ–­é™çº§">å››ã€ç†”æ–­é™çº§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_4-1-æ¦‚å¿µä»‹ç»">4.1 æ¦‚å¿µä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_4-2-resilience4j">4.2 Resilience4J</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#äº”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª">äº”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_5-1-micrometer-zipkin">5.1 Micrometer + Zipkin</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#å…­ã€gateway-ç½‘å…³">å…­ã€Gateway ç½‘å…³</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_6-1-gateway-ä¸‰å¤§æ ¸å¿ƒ">6.1 Gateway ä¸‰å¤§æ ¸å¿ƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_6-2-ç®€å•é…ç½®">6.2 ç®€å•é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_6-3-é«˜çº§ç‰¹æ€§">6.3 é«˜çº§ç‰¹æ€§</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="springcloud" tabindex="-1"><a class="header-anchor" href="#springcloud"><span>SpringCloud</span></a></h1><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>æœ¬æ–‡æ¡£åªè®²è§£å¾®æœåŠ¡çš„åŸºç¡€ä½¿ç”¨,æƒ³è¦äº†è§£æ·±å±‚æ¬¡çš„åŸç†è¯·è·³è¿‡ï¼Œé¿å…è€½è¯¯æ—¶é—´ï¼ï¼</p><p>æ‰€æœ‰ä»£ç å‡åœ¨GitHub,éœ€è¦è¯·è‡ªå–</p><p><a href="https://github.com/yangzhaoguang/cloud2024.git" target="_blank" rel="noopener noreferrer">https://github.com/yangzhaoguang/cloud2024.git<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p><strong>ç›®å‰å¸¸ç”¨çš„ç»„ä»¶</strong>ï¼š</p><figure><img src="/assets/img/image-20240403150037397.9f58d7c4.png" alt="image-20240403150037397" tabindex="0" loading="lazy"><figcaption>image-20240403150037397</figcaption></figure><h2 id="ä¸€ã€æ­å»ºç¤ºä¾‹é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ­å»ºç¤ºä¾‹é¡¹ç›®"><span>ä¸€ã€æ­å»ºç¤ºä¾‹é¡¹ç›®</span></a></h2><div class="hint-container note"><p class="hint-container-title">æ³¨</p><p>ä»¥ä¸‹ä¸ºè¯¦ç»†çš„æ­å»ºæµç¨‹ï¼Œè‹¥å«Œéº»çƒ¦ å¯ä»¥æ¥ clone æˆ‘çš„ä»£ç ï¼Œå›é€€åˆ° <code>BASE CODE</code> å³å¯ï¼ï¼ <a href="https://github.com/yangzhaoguang/cloud2024.git" target="_blank" rel="noopener noreferrer">https://github.com/yangzhaoguang/cloud2024.git<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p><strong>ä¸šåŠ¡å›¾</strong></p><p>æ¨¡æ‹Ÿè®¢å•æ”¯ä»˜çš„ç®€å•ä¸šåŠ¡</p><figure><img src="/assets/img/image-20240403190803023.93dc46db.png" alt="image-20240403190803023" tabindex="0" loading="lazy"><figcaption>image-20240403190803023</figcaption></figure><blockquote><p>æ•°æ®åº“è¡¨SQL</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>t_pay<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

 

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_pay<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>

  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>pay_no<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ”¯ä»˜æµæ°´å·&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>order_no<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è®¢å•æµæ°´å·&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;1&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·è´¦å·ID&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>amount<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;9.9&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;äº¤æ˜“é‡‘é¢&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span class="token punctuation">,</span>

  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">TIMESTAMP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ›´æ–°æ—¶é—´&#39;</span><span class="token punctuation">,</span>

  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>

<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;æ”¯ä»˜äº¤æ˜“è¡¨&#39;</span><span class="token punctuation">;</span>

 

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_pay<span class="token punctuation">(</span>pay_no<span class="token punctuation">,</span>order_no<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&#39;pay17203699&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;6544bafb424a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_pay<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-1-ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_1-1-ç¯å¢ƒæ­å»º"><span>1.1 ç¯å¢ƒæ­å»º</span></a></h3><p><strong>ç‰ˆæœ¬è¦æ±‚</strong></p><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>ç”±äºMavenä½¿ç”¨ç‰ˆæœ¬è¾ƒé«˜ï¼Œå¯èƒ½éœ€è¦å°†IDEAå‡çº§æˆ2023ï¼ˆ2022ä¸çŸ¥é“è¡Œä¸è¡Œï¼Œåæ­£2021ä¸è¡Œ~~ï¼‰</p></div><figure><img src="/assets/img/image-20240403150916271.cf59ae13.png" alt="image-20240403150916271" tabindex="0" loading="lazy"><figcaption>image-20240403150916271</figcaption></figure><p><strong>æ­å»ºMavençˆ¶å·¥ç¨‹</strong></p><figure><img src="/assets/img/image-20240403151142511.9d236738.png" alt="image-20240403151142511" tabindex="0" loading="lazy"><figcaption>image-20240403151142511</figcaption></figure><p><strong>ä¸€äº›Setting</strong></p><p><strong>å­—ç¬¦ç¼–ç </strong></p><figure><img src="/assets/img/image-20240403151215573.712d02a3.png" alt="image-20240403151215573" tabindex="0" loading="lazy"><figcaption>image-20240403151215573</figcaption></figure><p><strong>æ³¨è§£ç”Ÿæ•ˆ</strong></p><figure><img src="/assets/img/image-20240403151239930.21281479.png" alt="image-20240403151239930" tabindex="0" loading="lazy"><figcaption>image-20240403151239930</figcaption></figure><p><strong>Javaç¼–è¯‘ç‰ˆæœ¬</strong></p><figure><img src="/assets/img/image-20240403151300525.1b5f0b42.png" alt="image-20240403151300525" tabindex="0" loading="lazy"><figcaption>image-20240403151300525</figcaption></figure><p><strong>POM</strong></p><blockquote><p><strong>dependencyManagement å’Œ dependencies çš„åŒºåˆ«ï¼š</strong></p><p>dependencyManagement æ˜¯ç”¨æ¥ç®¡ç†ç‰ˆæœ¬ä¾èµ–ç‰ˆæœ¬å·çš„ ï¼Œå‡ºç°åœ¨çˆ¶å·¥ç¨‹ä¸­ ã€‚æ‰€æœ‰çš„å­é¡¹ç›®éƒ½ç»Ÿä¸€ä½¿ç”¨åŒä¸€ä¸ªç‰ˆæœ¬å·ã€‚ dependencyManagement å¹¶ä¸ä¼šå¼•å…¥ jar åŒ… ï¼Œè€Œæ˜¯å£°æ˜ jar åŒ…ï¼ŒçœŸæ­£å¼•å…¥ jar åº”è¯¥åœ¨ å­å·¥ç¨‹çš„ dependencies ä¸‹ ï¼Œè€Œåœ¨å­å·¥ç¨‹ä¸­ä¸éœ€è¦å†™å¦å¤–çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœéœ€è¦æ–°çš„ç‰ˆæœ¬å·åœ¨å­å·¥ç¨‹ä¸­é‡æ–°æŒ‡æ˜ version å³å¯ ï¼</p></blockquote><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.atguigu.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud2024<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hutool.version</span><span class="token punctuation">&gt;</span></span>5.8.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hutool.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok.version</span><span class="token punctuation">&gt;</span></span>1.18.26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">&gt;</span></span>1.1.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.springboot.version</span><span class="token punctuation">&gt;</span></span>3.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.springboot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>8.0.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger3.version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger3.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper.version</span><span class="token punctuation">&gt;</span></span>4.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson2.version</span><span class="token punctuation">&gt;</span></span>2.0.40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson2.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-api.version</span><span class="token punctuation">&gt;</span></span>1.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-api.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.test.version</span><span class="token punctuation">&gt;</span></span>3.1.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.test.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2023.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>2022.0.0.0-RC2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.alibaba.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springboot 3.2.0--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springcloud 2023.0.0--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--springcloud alibaba 2022.0.0.0-RC2--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.cloud.alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--SpringBooté›†æˆmybatis--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis.springboot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--Mysqlæ•°æ®åº“é©±åŠ¨8 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mysql.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--SpringBooté›†æˆdruidè¿æ¥æ± --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${druid.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--é€šç”¨Mapper4ä¹‹tk.mybatis--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mapper.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--persistence--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${persistence-api.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${fastjson2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- swagger3 è°ƒç”¨æ–¹å¼ http://ä½ çš„ä¸»æœºIPåœ°å€:5555/swagger-ui/index.html --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger3.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--hutool--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${hutool.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--lombok--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${lombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- spring-boot-starter-test --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.boot.test.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-mapper4ä¸€é”®ç”Ÿæˆ" tabindex="-1"><a class="header-anchor" href="#_1-2-mapper4ä¸€é”®ç”Ÿæˆ"><span>1.2 Mapper4ä¸€é”®ç”Ÿæˆ</span></a></h3><blockquote><p>å®˜ç½‘ï¼š<a href="https://github.com/abel533/Mapper" target="_blank" rel="noopener noreferrer">https://github.com/abel533/Mapper<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>åˆ›å»ºä¸€ä¸ªåç§°ä¸º <code>mybatis_generator2024</code> çš„Mavenå·¥ç¨‹</p><figure><img src="/assets/img/image-20240403154635126.fc1f2352.png" alt="image-20240403154635126" tabindex="0" loading="lazy"><figcaption>image-20240403154635126</figcaption></figure><p>å¼•å…¥ <code>POM</code>ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mybatis é€šç”¨mapper tkå•ç‹¬ä½¿ç”¨ï¼Œè‡ªå·±ç‹¬æœ‰+è‡ªå¸¦ç‰ˆæœ¬å·--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Mybatis Generator è‡ªå·±ç‹¬æœ‰+è‡ªå¸¦ç‰ˆæœ¬å·--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-generator-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--é€šç”¨Mapper--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mysql8.0--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-generator-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configurationFile</span><span class="token punctuation">&gt;</span></span>${basedir}/src/main/resources/generatorConfig.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configurationFile</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>overwrite</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>overwrite</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>verbose</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>verbose</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ›å»ºé…ç½®æ–‡ä»¶</strong></p><p><strong>properties</strong>ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment">#t_payè¡¨åŒ…å</span>
<span class="token key attr-name">package.name</span><span class="token punctuation">=</span><span class="token value attr-value">com.atguigu.cloud</span>

<span class="token comment"># mysql8.0</span>
<span class="token key attr-name">jdbc.driverClass</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">jdbc.url</span><span class="token punctuation">=</span> <span class="token value attr-value">jdbc:mysql://localhost:3306/cloud2024?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
<span class="token key attr-name">jdbc.user</span> <span class="token punctuation">=</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">jdbc.password</span> <span class="token punctuation">=</span><span class="token value attr-value">root</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>generatorConfig.xml</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">generatorConfiguration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config.properties<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetRuntime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MyBatis3Simple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultModelType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beginningDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>endingDelimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.generator.MapperPlugin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mappers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tk.mybatis.mapper.common.Mapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>caseSensitive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcConnection</span> <span class="token attr-name">driverClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.driverClass}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">connectionURL</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.url}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">userId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.user}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${jdbc.password}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbcConnection</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--åŒ…å--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaModelGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.entities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlMapGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javaClientGenerator</span> <span class="token attr-name">targetPackage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${package.name}.mapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">targetProject</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/main/java<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>XMLMAPPER<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--è¡¨åä»¥åŠå¯¹åº”çš„å®ä½“ç±»--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">tableName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t_pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">domainObjectName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Pay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generatedKey</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlStatement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>JDBC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generatorConfiguration</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸€åˆ‡å°±ç»ªä¹‹åï¼ŒåŒå‡»æ’ä»¶å³å¯</strong>ï¼š</p><figure><img src="/assets/img/image-20240403175504845.0da68085.png" alt="image-20240403175504845" tabindex="0" loading="lazy"><figcaption>image-20240403175504845</figcaption></figure><h3 id="_1-3-æ–°å»ºæ”¯ä»˜æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_1-3-æ–°å»ºæ”¯ä»˜æ¨¡å—"><span>1.3 æ–°å»ºæ”¯ä»˜æ¨¡å—</span></a></h3><p><strong>æ–°å»ºä¸€ä¸ªæ”¯ä»˜æ¨¡å—</strong></p><figure><img src="/assets/img/image-20240403180158686.834f8489.png" alt="image-20240403180158686" tabindex="0" loading="lazy"><figcaption>image-20240403180158686</figcaption></figure><p><strong>POM</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBooté›†æˆdruidè¿æ¥æ± --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Swagger3 è°ƒç”¨æ–¹å¼ http://ä½ çš„ä¸»æœºIPåœ°å€:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatiså’Œspringbootæ•´åˆ--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--Mysqlæ•°æ®åº“é©±åŠ¨8 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--persistence--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--é€šç”¨Mapper4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- fastjson2 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--test--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yamlé…ç½®æ–‡ä»¶</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>

<span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
    
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/cloud2024<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root

<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
    <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
    <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
        <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PayService</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Pay</span>   <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PayServiceImpl</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PayService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">PayMapper</span> payMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">insertSelective</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">deleteByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pay</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PayController</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">PayService</span> payService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Pay</span> pay<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;æˆåŠŸæ’å…¥è®°å½•ï¼Œè¿”å›å€¼ï¼š&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/del/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">deletePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/update&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updatePay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Pay</span> pay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">,</span> pay<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> i <span class="token operator">=</span> payService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;æˆåŠŸä¿®æ”¹è®°å½•ï¼Œè¿”å›å€¼ï¼š&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Pay</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> payService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token comment">//å…¨éƒ¨æŸ¥è¯¢getallä½œä¸ºå®¶åº­ä½œä¸š</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸»å¯åŠ¨ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.cloud.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main8001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main8001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PayDTO</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token comment">//æ”¯ä»˜æµæ°´å·</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> payNo<span class="token punctuation">;</span>
    <span class="token comment">//è®¢å•æµæ°´å·</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token comment">//ç”¨æˆ·è´¦å·ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
    <span class="token comment">//äº¤æ˜“é‡‘é¢</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å°†mybatis_generator2024ä¸­ç”Ÿæˆçš„ mapperã€entityæ‹·è´åˆ°æ­¤æ¨¡å—ï¼</p><p>æœ€åä½¿ç”¨postmanã€Swaggeræµ‹è¯•</p></blockquote><h3 id="_1-4-è§£å†³æ—¶é—´æ ¼å¼ã€åŒä¸€è¿”å›ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_1-4-è§£å†³æ—¶é—´æ ¼å¼ã€åŒä¸€è¿”å›ç»“æœ"><span>1.4 è§£å†³æ—¶é—´æ ¼å¼ã€åŒä¸€è¿”å›ç»“æœ</span></a></h3><p><strong>æ—¶é—´æ ¼å¼ä¿®æ”¹</strong></p><ul><li>ä¿®æ”¹yaml</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>    
    <span class="token key atrule">jackson</span><span class="token punctuation">:</span>
        <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŒ‡å®šå­—æ®µä¸Šä½¿ç”¨æ³¨è§£</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;update_time&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;create_time&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç»Ÿä¸€è¿”å›ç»“æœ</strong></p><p>é€šç”¨HTTPè¿”å›çŠ¶æ€ç ï¼š</p><figure><img src="/assets/img/image-20240403184340723.a767e72d.png" alt="image-20240403184340723" tabindex="0" loading="lazy"><figcaption>image-20240403184340723</figcaption></figure><p><strong>æšä¸¾ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ReturnCodeEnum</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**æ“ä½œå¤±è´¥**/</span>
    <span class="token function">RC999</span><span class="token punctuation">(</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ“ä½œXXXå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**æ“ä½œæˆåŠŸ**/</span>
    <span class="token function">RC200</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**æœåŠ¡é™çº§**/</span>
    <span class="token function">RC201</span><span class="token punctuation">(</span><span class="token string">&quot;201&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æœåŠ¡å¼€å¯é™çº§ä¿æŠ¤,è¯·ç¨åå†è¯•!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**çƒ­ç‚¹å‚æ•°é™æµ**/</span>
    <span class="token function">RC202</span><span class="token punctuation">(</span><span class="token string">&quot;202&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;çƒ­ç‚¹å‚æ•°é™æµ,è¯·ç¨åå†è¯•!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**ç³»ç»Ÿè§„åˆ™ä¸æ»¡è¶³**/</span>
    <span class="token function">RC203</span><span class="token punctuation">(</span><span class="token string">&quot;203&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ç³»ç»Ÿè§„åˆ™ä¸æ»¡è¶³è¦æ±‚,è¯·ç¨åå†è¯•!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**æˆæƒè§„åˆ™ä¸é€šè¿‡**/</span>
    <span class="token function">RC204</span><span class="token punctuation">(</span><span class="token string">&quot;204&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æˆæƒè§„åˆ™ä¸é€šè¿‡,è¯·ç¨åå†è¯•!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**access_denied**/</span>
    <span class="token function">RC403</span><span class="token punctuation">(</span><span class="token string">&quot;403&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ— è®¿é—®æƒé™,è¯·è”ç³»ç®¡ç†å‘˜æˆäºˆæƒé™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**access_denied**/</span>
    <span class="token function">RC401</span><span class="token punctuation">(</span><span class="token string">&quot;401&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;åŒ¿åç”¨æˆ·è®¿é—®æ— æƒé™èµ„æºæ—¶çš„å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">RC404</span><span class="token punctuation">(</span><span class="token string">&quot;404&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;404é¡µé¢æ‰¾ä¸åˆ°çš„å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**æœåŠ¡å¼‚å¸¸**/</span>
    <span class="token function">RC500</span><span class="token punctuation">(</span><span class="token string">&quot;500&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">RC375</span><span class="token punctuation">(</span><span class="token string">&quot;375&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ•°å­¦è¿ç®—å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">INVALID_TOKEN</span><span class="token punctuation">(</span><span class="token string">&quot;2001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è®¿é—®ä»¤ç‰Œä¸åˆæ³•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ACCESS_DENIED</span><span class="token punctuation">(</span><span class="token string">&quot;2003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">CLIENT_AUTHENTICATION_FAILED</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;å®¢æˆ·ç«¯è®¤è¯å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USERNAME_OR_PASSWORD_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">BUSINESS_ERROR</span><span class="token punctuation">(</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ä¸šåŠ¡é€»è¾‘å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">UNSUPPORTED_GRANT_TYPE</span><span class="token punctuation">(</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¸æ”¯æŒçš„è®¤è¯æ¨¡å¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**è‡ªå®šä¹‰çŠ¶æ€ç **/</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**è‡ªå®šä¹‰æè¿°**/</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//éå†æšä¸¾V1</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReturnCodeEnum</span> <span class="token function">getReturnCodeEnum</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span> element <span class="token operator">:</span> <span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> element<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//éå†æšä¸¾V2</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ReturnCodeEnum</span> <span class="token function">getReturnCodeEnumV2</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/*public static void main(String[] args)
    {
        System.out.println(getReturnCodeEnumV2(&quot;200&quot;));
        System.out.println(getReturnCodeEnumV2(&quot;200&quot;).getCode());
        System.out.println(getReturnCodeEnumV2(&quot;200&quot;).getMessage());
    }*/</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç»Ÿä¸€è¿”å›ç»“æœ</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span><span class="token doc-comment comment">/** ç»“æœçŠ¶æ€ ,å…·ä½“çŠ¶æ€ç å‚è§æšä¸¾ç±»ReturnCodeEnum.java*/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timestamp <span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC200</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC200</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultData<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1-5-å…¨å±€å¼‚å¸¸å¤„ç†"><span>1.5 å…¨å±€å¼‚å¸¸å¤„ç†</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * é»˜è®¤å…¨å±€å¼‚å¸¸å¤„ç†ã€‚
     * <span class="token keyword">@param</span> <span class="token parameter">e</span> the e
     * <span class="token keyword">@return</span> ResultData
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">exception</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----come in GlobalExceptionHandler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å…¨å±€å¼‚å¸¸ä¿¡æ¯exception:{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">ReturnCodeEnum</span><span class="token punctuation">.</span><span class="token constant">RC500</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-æ–°å»ºè®¢å•æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_1-6-æ–°å»ºè®¢å•æ¨¡å—"><span>1.6 æ–°å»ºè®¢å•æ¨¡å—</span></a></h3><figure><img src="/assets/img/image-20240403190958476.2d7cb661.png" alt="image-20240403190958476" tabindex="0" loading="lazy"><figcaption>image-20240403190958476</figcaption></figure><p><strong>POM</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--web + actuator--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--lombok--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--hutool-all--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--fastjson2--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- swagger3 è°ƒç”¨æ–¹å¼ http://ä½ çš„ä¸»æœºIPåœ°å€:5555/swagger-ui/index.html --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springdoc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springdoc-openapi-starter-webmvc-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸»å¯åŠ¨ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main80</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ç”±äºè®¢å•æ¨¡å—éœ€è¦è°ƒç”¨æ”¯ä»˜æ¨¡å—ï¼Œåœ¨æœªä½¿ç”¨å¾®æœåŠ¡ä¹‹å‰ï¼Œæš‚æ—¶é€šè¿‡ RESTTemplate è°ƒç”¨ï¼š</p></blockquote><p><strong>é…ç½®ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main80</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Controller</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">PaymentSrv_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8001&quot;</span><span class="token punctuation">;</span><span class="token comment">//å…ˆå†™æ­»ï¼Œç¡¬ç¼–ç </span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥urlï¼Œå‘é€çš„åªèƒ½æ˜¯getè¯·æ±‚
     * æˆ‘ä»¬åº•å±‚è°ƒç”¨çš„æ˜¯postæ–¹æ³•ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹è€…å‘é€getè¯·æ±‚ï¼Œå®¢æˆ·ç«¯æ¶ˆè´¹è€…
     * å‚æ•°å¯ä»¥ä¸æ·»åŠ @RequestBody
     * <span class="token keyword">@param</span> <span class="token parameter">payDTO</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token class-name">PaymentSrv_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">,</span>payDTO<span class="token punctuation">,</span><span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ é™¤+ä¿®æ”¹æ“ä½œä½œä¸ºå®¶åº­ä½œä¸šï¼ŒO(âˆ©_âˆ©)Oã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">PaymentSrv_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/get/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">ResultData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-7-ç›®å‰é¡¹ç›®å­˜åœ¨çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-7-ç›®å‰é¡¹ç›®å­˜åœ¨çš„é—®é¢˜"><span>1.7 ç›®å‰é¡¹ç›®å­˜åœ¨çš„é—®é¢˜</span></a></h3><p>é¡¹ç›®ä¸­æœ‰å¤§é‡é‡å¤çš„ä»£ç ï¼Œç±»ï¼Œé€šå¸¸åœ¨å¼€å‘ä¸­ï¼Œä¼šå°†<code>å…±åŒçš„ç±»</code>éƒ½å­˜æ”¾åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸‹</p><p>å› æ­¤æˆ‘ä»¬é‡æ–°åˆ›å»ºä¸€ä¸ª <code>cloud-api-commons</code> æ¨¡å—ï¼Œç”¨æ¥å­˜æ”¾å…¬å…±çš„ç±»ï¼</p><figure><img src="/assets/img/image-20240404085317620.61975c4a.png" alt="image-20240404085317620" tabindex="0" loading="lazy"><figcaption>image-20240404085317620</figcaption></figure><details class="hint-container details"><summary>ä¸Šé¢çš„Controllerä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ RESTTemplateè°ƒç”¨ æ”¯ä»˜æ¥å£ï¼Œè¿™æ ·æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</summary><p>1ã€å¦‚æœè®¢å•å¾®æœåŠ¡å’Œæ”¯ä»˜å¾®æœåŠ¡çš„IPåœ°å€æˆ–è€…ç«¯å£å·å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™éœ€è¦é‡æ–°ä¿®æ”¹</p><p>2ã€å¦‚æœç³»ç»Ÿä¸­æä¾›äº†å¤šä¸ªè®¢å•å¾®æœåŠ¡å’Œæ”¯ä»˜å¾®æœåŠ¡ï¼Œåˆ™æ— æ³•å®ç°å¾®æœåŠ¡çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½</p><p>3ã€å¦‚æœç³»ç»Ÿéœ€è¦æ”¯æŒæ›´é«˜çš„å¹¶å‘ï¼Œéœ€è¦éƒ¨ç½²æ›´å¤šçš„è®¢å•å¾®æœåŠ¡å’Œæ”¯ä»˜å¾®æœåŠ¡ï¼Œç¡¬ç¼–ç è®¢å•å¾®æœåŠ¡åˆ™åç»­çš„ç»´æŠ¤ä¼šå˜å¾—å¼‚å¸¸å¤æ‚</p><p>å› æ­¤ï¼Œå°±ä¸‹æ¥å°±å­¦ä¹  å¾®æœåŠ¡ï¼ï¼</p></details><h2 id="äºŒã€consul" tabindex="-1"><a class="header-anchor" href="#äºŒã€consul"><span>äºŒã€Consul</span></a></h2><h3 id="_2-1-ä»‹ç»ã€å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2-1-ä»‹ç»ã€å®‰è£…"><span>2.1 ä»‹ç»ã€å®‰è£…</span></a></h3><p>Consul æ˜¯ä¸€å¥—å¼€æºçš„åˆ†<code>å¸ƒå¼æœåŠ¡å‘ç°</code>å’Œ <code>é…ç½®ç®¡ç†ç³»ç»Ÿ</code>ï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘ã€‚</p><p>æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„<code>æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿</code>ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼ï¼Œæ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>åŠŸèƒ½</strong></p><ul><li><p>æœåŠ¡å‘ç° ï¼š æä¾› HTTP å’Œ DNS ä¿©ä¸­å‘ç°æ–¹å¼</p></li><li><p>å¥åº·æ£€æµ‹ï¼šæ”¯æŒå¤šç§æ–¹å¼ï¼ŒHTTPã€TCP</p></li><li><p>KV å­˜å‚¨ï¼šKeyã€Value çš„å­˜å‚¨æ–¹å¼</p></li><li><p>å¤šæ•°æ®ä¸­å¿ƒ</p></li><li><p>å¯è§†åŒ– Web ç•Œé¢</p></li></ul><details class="hint-container details"><summary>ä¸‹è½½</summary><p><a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener noreferrer">https://www.consul.io/downloads.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸‹è½½ååªæœ‰ä¸€ä¸ª exe æ–‡ä»¶ï¼Œä½¿ç”¨ cmd å‘½ä»¤è¡ŒæŸ¥çœ‹ consul ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>consul <span class="token parameter variable">-version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨å¼€å‘è€…æ¨¡å¼å¯åŠ¨ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>consul agent <span class="token parameter variable">-dev</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è®¿é—® web ç®¡ç†ç•Œé¢ï¼š</p><p><a href="http://localhost:8500" target="_blank" rel="noopener noreferrer">http://localhost:8500<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></details><h3 id="_2-2-æœåŠ¡æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#_2-2-æœåŠ¡æ³¨å†Œ"><span>2.2 æœåŠ¡æ³¨å†Œ</span></a></h3><p><strong>POMå¢åŠ ä¾èµ–</strong></p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">consul</span><span class="token punctuation">:</span>
            <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
            <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
                <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span> <span class="token comment"># æœåŠ¡å</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»å¯åŠ¨ç±»å¢åŠ  <code>@EnableDiscoveryClient</code> æ³¨è§£ï¼</p><p><strong>å¯åŠ¨æŠ¥é”™</strong></p><figure><img src="/assets/img/image-20240404093343196.2cf90190.png" alt="image-20240404093343196" tabindex="0" loading="lazy"><figcaption>image-20240404093343196</figcaption></figure><p>ä¸ <code>commons-logging</code> åŒ…å†²çªï¼Œéœ€è¦åœ¨ä¾èµ–ä¸­æ’é™¤</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-å°é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-3-å°é—®é¢˜"><span>2.3 å°é—®é¢˜</span></a></h3><p>æ­¤æ—¶å·²ç»å°†ä¿©ä¸ªæ¨¡å—æ³¨å†Œåˆ° Consul ä¸­ï¼Œåœ¨ <code>OrderController </code>ä¸­å°±å¯ä»¥ä½¿ç”¨ <code>æœåŠ¡å</code> æ›¿ä»£å…·ä½“çš„ IPåœ°å€äº†</p><figure><img src="/assets/img/image-20240404094642750.41013b81.png" alt="image-20240404094642750" tabindex="0" loading="lazy"><figcaption>image-20240404094642750</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">PaymentSrv_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://cloud-payment-service&quot;</span><span class="token punctuation">;</span><span class="token comment">//æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸Šçš„å¾®æœåŠ¡åç§°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤æ—¶è®¿é—® <code>http://localhost:80/consumer/pay/get/1</code> æŠ¥é”™ï¼Œ</p><figure><img src="/assets/img/image-20240404095040744.443dce46.png" alt="image-20240404095040744" tabindex="0" loading="lazy"><figcaption>image-20240404095040744</figcaption></figure><p>è¿™æ˜¯å› ä¸º Consul å¤©ç”Ÿæ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œé»˜è®¤æœ‰å¤šä¸ª<code>cloud-payment-service</code>ï¼Œéœ€è¦é…ç½®è´Ÿè½½å‡è¡¡ï¼Œåœ¨ <code>RestTemplate</code> æ–¹æ³•ä¸Šå¢åŠ  <code>@LoadBalanced</code> æ³¨è§£</p><figure><img src="/assets/img/image-20240404095624490.155445dc.png" alt="image-20240404095624490" tabindex="0" loading="lazy"><figcaption>image-20240404095624490</figcaption></figure><h3 id="_2-4-åˆ†å¸ƒå¼é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-4-åˆ†å¸ƒå¼é…ç½®"><span>2.4 åˆ†å¸ƒå¼é…ç½®</span></a></h3><p>ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¸€å¥—<code>é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®</code>ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ¯”å¦‚æŸäº›é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¤§éƒ¨åˆ†éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰ä¸ªåˆ«çš„é…ç½®é¡¹ä¸åŒã€‚å°±æ‹¿æ•°æ®åº“é…ç½®æ¥è¯´å§ï¼Œå¦‚æœæ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨çš„æŠ€æœ¯æ ˆéƒ½æ˜¯ç›¸åŒçš„ï¼Œåˆ™æ¯ä¸ªå¾®æœåŠ¡ä¸­å…³äºæ•°æ®åº“çš„é…ç½®å‡ ä¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œæœ‰æ—¶å€™ä¸»æœºè¿ç§»äº†ï¼Œæˆ‘å¸Œæœ›<code>ä¸€æ¬¡ä¿®æ”¹ï¼Œå¤„å¤„ç”Ÿæ•ˆ</code>ã€‚</p><blockquote><p>åœ¨ Consul ä¸­æä¾›äº† <code>åˆ†å¸ƒå¼é…ç½®</code> çš„åŠŸèƒ½ï¼Œä¸‹é¢çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼</p></blockquote><p><strong>Consul é…ç½®è§„åˆ™</strong></p><p>é»˜è®¤æ˜¯ <code>config/åº”ç”¨å,ç¯å¢ƒ/data</code> ï¼Œé»˜è®¤è¯»å–<code>data </code>é…ç½®æ–‡ä»¶</p><blockquote><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>config/application,dev/data
config/application/data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>åˆ†éš”ç¬¦å¯é€šè¿‡: <code>spring.cloud.consul.config.profile-separator </code> è®¾ç½®</p><p>è¯»å–çš„é…ç½®æ–‡ä»¶å¯ä»¥é€šè¿‡: <code>spring.cloud.consul.config.data-key </code> é…ç½®</p><p>1ã€å¼•å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!--SpringCloud consul config--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€æ–°å¢ <code>bootstrap.yaml </code>é…ç½®æ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
    <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">profile-separator</span><span class="token punctuation">:</span> <span class="token string">&#39;-&#39;</span> <span class="token comment"># default value is &quot;,&quot;ï¼Œwe update &#39;-&#39;</span>
        <span class="token key atrule">format</span><span class="token punctuation">:</span> YAML
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€<code>application.yaml</code></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>

<span class="token comment"># ==========applicationName + druid-mysql8 driver===================</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/cloud2024<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false&amp;serverTimezone=GMT%2B8&amp;rewriteBatchedStatements=true&amp;allowPublicKeyRetrieval=true</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root


<span class="token comment"># ========================mybatis===================</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
    <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.atguigu.cloud.entities
    <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
        <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>applicaiton.ymlæ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹</p><p>bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜</p></blockquote><p>4ã€åœ¨ Consul ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¸€å®šè¦ç¬¦åˆ è§„åˆ™</p><p>ä¸€å…±æœ‰ä¸‰å±‚ï¼š</p><ul><li><p>ç¬¬ä¸€å±‚ä¸º <code>config/</code></p></li><li><p>ç¬¬äºŒå±‚ä¸ºï¼š<code>åº”ç”¨å-ç¯å¢ƒ/</code></p></li><li><p>ç¬¬ä¸‰å±‚ä¸º <code>dataé…ç½®æ–‡ä»¶</code></p></li></ul><p>æ³¨æ„å³ä¸Šè§’çš„æ ¼å¼ä¸º <code>Yaml</code>ï¼Œè¦å’Œä½ é…ç½®çš„<code>format</code> ä¸€æ ·</p><figure><img src="/assets/img/image-20240404153112431.a5146f9a.png" alt="image-20240404153112431" tabindex="0" loading="lazy"><figcaption>image-20240404153112431</figcaption></figure><h3 id="_2-5-åŠ¨æ€åˆ·æ–°" tabindex="-1"><a class="header-anchor" href="#_2-5-åŠ¨æ€åˆ·æ–°"><span>2.5 åŠ¨æ€åˆ·æ–°</span></a></h3><p>å½“ä¿®æ”¹ Consul ä¸Šçš„é…ç½®æ—¶ï¼Œå®¢æˆ·ç«¯æ— æ³•åšåˆ°å®æ—¶æ›´æ–°</p><ul><li><p>åœ¨ä¸»å¯åŠ¨ç±»ä¸Š<code>@RefreshScope</code> æ³¨è§£</p></li><li><p>å¯ä»¥è®¾ç½® <code>spring.cloud.consul.config.watch.wait-time</code> æŒ‡æ˜ç­‰å¾…å¤šå°‘æ—¶é—´åŒæ­¥æ›´æ–°ï¼Œé»˜è®¤æ˜¯<code> 55s</code></p></li></ul><h3 id="_2-6-é…ç½®æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-6-é…ç½®æŒä¹…åŒ–"><span>2.6 é…ç½®æŒä¹…åŒ–</span></a></h3><p>å½“Consul é‡å¯ä¹‹åï¼Œåœ¨ä¸Šé¢çš„é…ç½®å°±ä¼š<code>æ¶ˆå¤±</code> ï¼Œ å› æ­¤éœ€è¦é…ç½®<code> æŒä¹…åŒ–</code> , ä¿è¯ é…ç½®ä¸ä¼šä¸¢å¤±</p><p>1ã€åˆ›å»ºä¸€ä¸ª<code> myData</code> æ–‡ä»¶å¤¹ï¼Œå°†é…ç½®ä¿å­˜åœ¨æ­¤å¤„</p><figure><img src="/assets/img/image-20240404161459754.df44a55d.png" alt="image-20240404161459754" tabindex="0" loading="lazy"><figcaption>image-20240404161459754</figcaption></figure><p>2ã€åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»º <code>consul_start.bat</code> å¯åŠ¨è„šæœ¬</p><p>å°† <code>-data-dirã€binpath </code> æ”¹æˆä½ è‡ªå·± çš„è·¯å¾„</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>@echo.æœåŠ¡å¯åŠ¨<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>  
@echo off  
@sc create Consul <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">&quot;C:\Java\java_notes<span class="token entity" title="\13">\13</span>.SpringCloud\software<span class="token entity" title="\c">\c</span>onsul.exe agent -server -ui -bind=127.0.0.1 -client=0.0.0.0 -bootstrap-expect  1  -data-dir C:\Java\java_notes<span class="token entity" title="\13">\13</span>.SpringCloud\software\myData&quot;</span>
@net start Consul
@sc config Consul <span class="token assign-left variable">start</span><span class="token operator">=</span> AUTO  
@echo.Consul start is OK<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>success
@pause
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‹¥ä½ ç¬¬ä¸€æ¬¡å› ä¸º <code>è·¯å¾„é”™è¯¯</code> æ‰¾ä¸åˆ°æ–‡ä»¶å¯åŠ¨å¤±è´¥ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨ <code>cmd</code> , æ‰§è¡Œ <code>sc delete Consul</code> å, ä¿®æ”¹æ­£ç¡®çš„è·¯å¾„ï¼Œå†æ¬¡ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>bat</code></p><p>3ã€ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¯åŠ¨æˆåŠŸ</p><figure><img src="/assets/img/image-20240404162958313.1c569b46.png" alt="image-20240404162958313" tabindex="0" loading="lazy"><figcaption>image-20240404162958313</figcaption></figure><p>4ã€æ­¤æ—¶åœ¨ Consul ä¸Šå¢åŠ çš„é…ç½®å°±ä¼šä¿å­˜åˆ° <code>myData </code>ç›®å½•ä¸‹</p><figure><img src="/assets/img/image-20240404163255634.8ebee1e0.png" alt="image-20240404163255634" tabindex="0" loading="lazy"><figcaption>image-20240404163255634</figcaption></figure><h2 id="ä¸‰ã€æœåŠ¡è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æœåŠ¡è°ƒç”¨"><span>ä¸‰ã€æœåŠ¡è°ƒç”¨</span></a></h2><h3 id="_3-1-loadbalance" tabindex="-1"><a class="header-anchor" href="#_3-1-loadbalance"><span>3.1 LoadBalance</span></a></h3><h4 id="_3-1-1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-1-1-ä»‹ç»"><span>3.1.1 ä»‹ç»</span></a></h4><p>ç”±äº SpringCloud çš„ Ribbon å·²ç»åœæ›´ï¼Œå®˜ç½‘æ˜ç¡®è¯´æ˜ä½¿ç”¨ <code>LoadBalance</code>æ›¿æ¢ Ribbon</p><blockquote><p><strong>LBè´Ÿè½½å‡è¡¡(Load Balance)æ˜¯ä»€ä¹ˆ</strong></p></blockquote><p>ç®€å•çš„è¯´å°±æ˜¯<code>å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Š</code>ï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginxï¼ŒLVSï¼Œç¡¬ä»¶ F5ç­‰ã€‚</p><blockquote><p><strong>LoadBalanceæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«</strong></p></blockquote><p>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚</p><p>LoadBalanceæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å…¶ä»–å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚</p><h4 id="_3-1-2-å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_3-1-2-å¦‚ä½•ä½¿ç”¨"><span>3.1.2 å¦‚ä½•ä½¿ç”¨</span></a></h4><div class="hint-container tip"><p class="hint-container-title">å®˜ç½‘åœ°å€</p><p><a href="https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p>ä»å®˜ç½‘å¾—çŸ¥ LB ä¸º<code>è´Ÿè½½å‡è¡¡å™¨çš„æŠ½è±¡å’Œå®ç°</code></p><figure><img src="/assets/img/image-20240404160254565.91ee4cc6.png" alt="image-20240404160254565" tabindex="0" loading="lazy"><figcaption>image-20240404160254565</figcaption></figure><p>å…·ä½“çš„é€šè¿‡ RestTemplate å®ç° LB</p><figure><img src="/assets/img/image-20240404160411124.93275393.png" alt="image-20240404160411124" tabindex="0" loading="lazy"><figcaption>image-20240404160411124</figcaption></figure><p>å¯é€šè¿‡å¢åŠ  <code>@LoadBalanced </code>ã€<code> @Bean</code> ä¿©ä¸ªæ³¨è§£å®ç° LB</p><figure><img src="/assets/img/image-20240404160450799.e5339f51.png" alt="image-20240404160450799" tabindex="0" loading="lazy"><figcaption>image-20240404160450799</figcaption></figure><h4 id="_3-1-3-æ¡ˆä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_3-1-3-æ¡ˆä¾‹æ¼”ç¤º"><span>3.1.3 æ¡ˆä¾‹æ¼”ç¤º</span></a></h4><p>æ‹·è´ 8001 ä¸º 8002 å¾®æœåŠ¡ï¼Œé€šè¿‡è°ƒç”¨ 80 æœåŠ¡ï¼Œæ¥å®ç° 8001/8002 çš„è´Ÿè½½å‡è¡¡</p><p>å¯åŠ¨æˆåŠŸåï¼ŒConsulä¸­ <code>cloud-payment-service</code> æœåŠ¡å·²ç»å˜æˆä¿©ä¸ªï¼Œä¸€ä¸ª8001ï¼Œä¸€ä¸ª8002</p><figure><img src="/assets/img/image-20240404165630286.828dc80b.png" alt="image-20240404165630286" tabindex="0" loading="lazy"><figcaption>image-20240404165630286</figcaption></figure><p>ä¿®æ”¹80è®¢å•æœåŠ¡ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡è°ƒç”¨ 8001/8002</p><p>1ã€æ–°å¢ loadbalance ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€ä¿®æ”¹Controller</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/consumer/pay/get/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getInfoByConsul</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">PaymentSrv_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/pay/get/info&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€è®¿é—® <code>/consumer/pay/get/info</code></p><h4 id="_3-1-4-è´Ÿè½½å‡è¡¡åŸç†" tabindex="-1"><a class="header-anchor" href="#_3-1-4-è´Ÿè½½å‡è¡¡åŸç†"><span>3.1.4 è´Ÿè½½å‡è¡¡åŸç†</span></a></h4><blockquote><p><strong>restæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡</strong></p><p>æ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä» 1 å¼€å§‹ã€‚</p></blockquote><p><strong>ä¾‹å¦‚</strong>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

å¦‚ï¼š   <span class="token class-name">List</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> instances <span class="token operator">=</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8002</span>
ã€€ã€€   <span class="token class-name">List</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> instances <span class="token operator">=</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8001</span>

<span class="token number">8001</span><span class="token operator">+</span> <span class="token number">8002</span> ç»„åˆæˆä¸ºé›†ç¾¤ï¼Œå®ƒä»¬å…±è®¡<span class="token number">2</span>å°æœºå™¨ï¼Œé›†ç¾¤æ€»æ•°ä¸º<span class="token number">2</span>ï¼Œ æŒ‰ç…§è½®è¯¢ç®—æ³•åŸç†ï¼š

å½“æ€»è¯·æ±‚æ•°ä¸º<span class="token number">1</span>æ—¶ï¼š <span class="token number">1</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token number">1</span> å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º<span class="token number">1</span> ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8001</span>
å½“æ€»è¯·æ±‚æ•°ä½<span class="token number">2</span>æ—¶ï¼š <span class="token number">2</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token number">0</span> å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º<span class="token number">0</span> ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8002</span>
å½“æ€»è¯·æ±‚æ•°ä½<span class="token number">3</span>æ—¶ï¼š <span class="token number">3</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token number">1</span> å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º<span class="token number">1</span> ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8001</span>
å½“æ€»è¯·æ±‚æ•°ä½<span class="token number">4</span>æ—¶ï¼š <span class="token number">4</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token number">0</span> å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º<span class="token number">0</span> ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8002</span>
å¦‚æ­¤ç±»æ¨<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-openfeign" tabindex="-1"><a class="header-anchor" href="#_3-2-openfeign"><span>3.2 OpenFeign</span></a></h3><h4 id="_3-2-1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_3-2-1-ä»‹ç»"><span>3.2.1 ä»‹ç»</span></a></h4><div class="hint-container tip"><p class="hint-container-title">å®˜ç½‘åœ°å€</p><p><a href="https://github.com/spring-cloud/spring-cloud-openfeign" target="_blank" rel="noopener noreferrer">https://github.com/spring-cloud/spring-cloud-openfeign<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ï¼Œè®©ç¼–å†™WebæœåŠ¡å®¢æˆ·ç«¯å˜å¾—éå¸¸å®¹æ˜“ï¼Œ<strong>åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ  @FeignClient æ³¨è§£å³å¯</strong></p><blockquote><p><strong>OpenFeign è¾ƒä¸ Loadbalance çš„ä¼˜åŠ¿</strong>ï¼Ÿ</p></blockquote><p>å‰é¢åœ¨ä½¿ç”¨ LoadBalance æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ <code>New RestTemplate</code> å»è°ƒç”¨æœåŠ¡ç«¯æ¥å£ï¼Œä½†å®é™…ä¸Šä¸€ä¸ªé¡¹ç›®ä¸­å¯èƒ½æœ‰å¤šå¤„éœ€è¦è°ƒç”¨ï¼Œæ¯ä¸€ä¸ªéƒ½è¦è‡ªå·±å» <code>New</code>ï¼Œ ä¸€æ˜¯<code>ç®¡ç†ä¸æ–¹ä¾¿</code>ï¼ŒäºŒæ˜¯å¹¶<code>æ²¡æœ‰å®ç°æ¥å£ç¼–ç¨‹</code>ï¼</p><p>è€Œ OpenFeign çš„å‡ºç°æ­£è§£å†³äº†è¿™ä¸€éš¾é¢˜ï¼Œé€šè¿‡<code>å®šä¹‰ä¸€ä¸ªæ¥å£ + ä¸€ä¸ªæ³¨è§£</code> å®Œæˆ å¯¹å¤–æš´éœ²å¯ä»¥è¢«è°ƒç”¨çš„æ¥å£æ–¹æ³•æ¸…å•ã€‚å¤§å¤§ç®€åŒ–å’Œé™ä½äº†è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</p><p>OpenFeignåŒæ—¶è¿˜é›†æˆ<code>SpringCloud LoadBalancer</code>ã€<code>é˜¿é‡Œå·´å·´Sentinelæ¥æä¾›ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½</code>ã€‚</p><h4 id="_3-2-2-å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_3-2-2-å¦‚ä½•ä½¿ç”¨"><span>3.2.2 å¦‚ä½•ä½¿ç”¨</span></a></h4><p>1ã€å¢åŠ ä¾èµ–</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>openfeign<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€åœ¨<strong>å®¢æˆ·ç«¯</strong>çš„ä¸»å¯åŠ¨ç±»ä¸Šå¢åŠ  <code>@EnableFeignClients</code> æ³¨è§£</p><blockquote><p>éœ€è¦è°ƒç”¨æ¥å£çš„ æ¨¡å— å¢åŠ  @EnableFeignClients</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€å†å®¢æˆ·ç«¯ä¸­æš´éœ²çš„æ¥å£æ¸…å•ä¸­å¢åŠ  <code>@FeignClient(&quot;stores&quot;)</code> ï¼Œ é‡Œé¢çš„valueå€¼ä¸º <code>æœåŠ¡ç«¯åç§°</code>ï¼Œä¹Ÿå°±æ˜¯å®ç°è¿™äº›æ–¹æ³•çš„æ¨¡å—ï¼</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;stores&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StoreClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;/stores&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Store</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStores</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;/stores&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Store</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStores</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;/stores/{storeId}&quot;</span><span class="token punctuation">,</span> consumes <span class="token operator">=</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Store</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;storeId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> storeId<span class="token punctuation">,</span> <span class="token class-name">Store</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;/stores/{storeId:\\d+}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> storeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-æ¡ˆä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_3-2-3-æ¡ˆä¾‹æ¼”ç¤º"><span>3.2.3 æ¡ˆä¾‹æ¼”ç¤º</span></a></h4><blockquote><p>å°†æœåŠ¡ç«¯æä¾›çš„æ¥å£æ¸…å• æ”¾åœ¨é€šç”¨æ¨¡å— common ä¸­ï¼Œé€šè¿‡OpenFeign è°ƒç”¨æœåŠ¡ç«¯ä¸­å…·ä½“çš„Controller æ–¹æ³•ï¼</p></blockquote><figure><img src="/assets/img/image-20240404180225749.ec647589.png" alt="image-20240404180225749" tabindex="0" loading="lazy"><figcaption>image-20240404180225749</figcaption></figure><p>1ã€åœ¨ <code>commons </code>å…¬å…±æ¨¡å—ä¸­å¢åŠ  OpenFeign ä¾èµ–</p><p>2ã€æä¾›æœåŠ¡ç«¯æš´éœ²çš„æ¥å£æ¸…å•ï¼Œä½¿ç”¨ <code>@FeignClient </code>æŒ‡æ˜æœåŠ¡ç«¯åç§°ï¼</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡æ˜æœåŠ¡ç«¯çš„æœåŠ¡å</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayFeignApi</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * æ–°å¢ä¸€æ¡æ”¯ä»˜ç›¸å…³æµæ°´è®°å½•
     * <span class="token keyword">@param</span> <span class="token parameter">payDTO</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">addPay</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æŒ‰ç…§ä¸»é”®è®°å½•æŸ¥è¯¢æ”¯ä»˜æµæ°´ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// public ResultData getPayInfo(@PathVariable Integer id); // è¿™æ ·å†™æ˜¯é”™è¯¯çš„ï¼Œå¿…é¡»æŒ‡æ˜è·¯å¾„å‚æ•°åç§°</span>

    <span class="token doc-comment comment">/**
     * openfeignå¤©ç„¶æ”¯æŒè´Ÿè½½å‡è¡¡æ¼”ç¤º
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/get/info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">mylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€æ–°å»ºæ¨¡å— <code>cloud-consumer-feign-order80</code></p><p><strong>POM</strong> å’Œ <code>cloud-consumer-order80</code> ä¸€æ ·</p><p><strong>YAML</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>openfeign<span class="token punctuation">-</span>order
    <span class="token comment">####Spring Cloud Consul for Service Discovery</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">consul</span><span class="token punctuation">:</span>
            <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
            <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
                <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#ä¼˜å…ˆä½¿ç”¨æœåŠ¡ipè¿›è¡Œæ³¨å†Œ</span>
                <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸»å¯åŠ¨ç±»</strong></p><p>å†å®¢æˆ·ç«¯çš„ä¸»å¯åŠ¨ç±»ä¸Šå¢åŠ  <code>@EnableFeignClients</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainOpenFeign80</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MainOpenFeign80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Controller</strong></p><p>ä½¿ç”¨äº† OpenFeignï¼Œæ­¤æ—¶åœ¨ Controller ä¸­å°±æ— éœ€åœ¨ä½¿ç”¨ RestTemplateï¼Œå¼•å…¥æ‰€åˆ›å»ºçš„ <code>PayFeignApi</code> æ¥å£æ¸…å•</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign/pay/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PayDTO</span> payDTO<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬ä¸€æ­¥ï¼šæ¨¡æ‹Ÿæœ¬åœ°addOrderæ–°å¢è®¢å•æˆåŠŸ(çœç•¥sqlæ“ä½œ)ï¼Œç¬¬äºŒæ­¥ï¼šå†å¼€å¯addPayæ”¯ä»˜å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultData</span> resultData <span class="token operator">=</span> payFeignApi<span class="token punctuation">.</span><span class="token function">addPay</span><span class="token punctuation">(</span>payDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/feign/pay/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultData</span> <span class="token function">getPayInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------æ”¯ä»˜å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨ï¼ŒæŒ‰ç…§idæŸ¥è¯¢è®¢å•æ”¯ä»˜æµæ°´ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultData</span> resultData <span class="token operator">=</span> payFeignApi<span class="token punctuation">.</span><span class="token function">getPayInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * openfeignå¤©ç„¶æ”¯æŒè´Ÿè½½å‡è¡¡æ¼”ç¤º
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/mylb&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">mylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">mylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œæµç¨‹</strong></p><blockquote><p>å®¢æˆ·ç«¯order80æœåŠ¡ é€šè¿‡<code>PayFeignApi</code>è°ƒç”¨æœåŠ¡ç«¯æš´éœ²çš„æ¥å£ï¼Œåœ¨PayFeignApiä¸­é€šè¿‡ <code>@FeignClient</code> ä¸­çš„æœåŠ¡ç«¯åç§°å»<code>Consul </code>ä¸­æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œæœ€åè°ƒç”¨æœåŠ¡ç«¯æä¾›çš„æœåŠ¡æ¥å£ï¼</p></blockquote><h4 id="_3-2-4-é«˜çº§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_3-2-4-é«˜çº§ç‰¹æ€§"><span>3.2.4 é«˜çº§ç‰¹æ€§</span></a></h4><h5 id="_1ã€è¶…æ—¶æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#_1ã€è¶…æ—¶æ§åˆ¶"><span>1ã€è¶…æ—¶æ§åˆ¶</span></a></h5><blockquote><p>OpenFeignçš„é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º60s</p></blockquote><figure><img src="/assets/img/image-20240404185845647.adcc0df4.png" alt="image-20240404185845647" tabindex="0" loading="lazy"><figcaption>image-20240404185845647</figcaption></figure><ul><li>å…¨å±€é…ç½®</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
            <span class="token key atrule">client</span><span class="token punctuation">:</span>
                <span class="token key atrule">config</span><span class="token punctuation">:</span>
                  <span class="token key atrule">default</span><span class="token punctuation">:</span>
                      <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
                      <span class="token key atrule">read-timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å±€éƒ¨é…ç½®(æŒ‡å®šå“ªä¸ªæœåŠ¡çš„è¶…æ—¶æ—¶é—´)</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">config</span><span class="token punctuation">:</span>
          <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
            		<span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span>
                      <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
            		<span class="token comment">#è¯»å–è¶…æ—¶æ—¶é—´</span>
                      <span class="token key atrule">readTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/img/image-20240404190229058.7a440d9b.png" alt="image-20240404190229058" tabindex="0" loading="lazy"><figcaption>image-20240404190229058</figcaption></figure><h5 id="_2ã€é‡è¯•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_2ã€é‡è¯•æœºåˆ¶"><span>2ã€é‡è¯•æœºåˆ¶</span></a></h5><blockquote><p>é»˜è®¤å…³é—­</p></blockquote><p>å¢åŠ é…ç½®ç±»å¼€å¯é‡è¯•æœºåˆ¶ï¼š</p><blockquote><p>æœ€å¤§è¯·æ±‚æ¬¡æ•°3æ¬¡ï¼š</p><ul><li>åˆå§‹è¯·æ±‚ä¸€æ¬¡</li><li>é‡è¯•ä¿©æ¬¡</li></ul></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignConfig</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Retryer</span> <span class="token function">myRetryer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// return Retryer.NEVER_RETRY; //Feigné»˜è®¤é…ç½®æ˜¯ä¸èµ°é‡è¯•ç­–ç•¥çš„</span>

        <span class="token comment">// æœ€å¤§è¯·æ±‚æ¬¡æ•°ä¸º3(1+2)ï¼Œåˆå§‹é—´éš”æ—¶é—´ä¸º100msï¼Œé‡è¯•é—´æœ€å¤§é—´éš”æ—¶é—´ä¸º1s</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Retryer<span class="token punctuation">.</span>Default</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><p>åœ¨ä¸Šé¢æˆ‘å°†è¶…æ—¶æ—¶é—´è®¾ç½®äº†5sï¼Œé‡è¯•3æ¬¡ï¼Œé‚£ä¹ˆæ‰§è¡Œé—´éš”ä¸º 15S</p><figure><img src="/assets/img/image-20240404190854797.09d52085.png" alt="image-20240404190854797" tabindex="0" loading="lazy"><figcaption>image-20240404190854797</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>ç›®å‰æ§åˆ¶å°æ²¡æœ‰çœ‹åˆ°3æ¬¡é‡è¯•è¿‡ç¨‹ï¼Œåªçœ‹åˆ°ç»“æœï¼Œ<strong>æ­£å¸¸çš„ï¼Œæ­£ç¡®çš„</strong>ï¼Œæ˜¯feignçš„æ—¥å¿—æ‰“å°é—®é¢˜</p></div><h5 id="_3ã€é»˜è®¤httpclientä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#_3ã€é»˜è®¤httpclientä¿®æ”¹"><span>3ã€é»˜è®¤HttpClientä¿®æ”¹</span></a></h5><p>OpenFeignä¸­http client å¦‚æœä¸åšç‰¹æ®Šé…ç½®ï¼ŒOpenFeigné»˜è®¤ä½¿ç”¨JDKè‡ªå¸¦çš„ <code>HttpURLConnection</code>å‘é€HTTPè¯·æ±‚ï¼Œç”±äºé»˜è®¤HttpURLConnection<code>æ²¡æœ‰è¿æ¥æ± ã€æ€§èƒ½å’Œæ•ˆç‡æ¯”è¾ƒä½</code></p><blockquote><p>å› æ­¤ä½¿ç”¨ Apache HttpClient5 æ›¿æ¢é»˜è®¤çš„HttpURLConnection</p></blockquote><p>1ã€å¢åŠ ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!-- httpclient5--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents.client5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- feign-hc5--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-hc5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>13.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å¼€å¯</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment">#  Apache HttpClient5 é…ç½®å¼€å¯</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">hc5</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="/assets/img/image-20240404191738868.949da682.png" alt="image-20240404191738868" tabindex="0" loading="lazy"><figcaption>image-20240404191738868</figcaption></figure><h5 id="_4ã€è¯·æ±‚-å“åº”å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#_4ã€è¯·æ±‚-å“åº”å‹ç¼©"><span>4ã€è¯·æ±‚/å“åº”å‹ç¼©</span></a></h5><p><strong>å¼€å¯è¯·æ±‚/å“åº”å‹ç¼©ã€è®¾ç½®å‡ºå‘å‹ç¼©å¤§å°</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
            <span class="token key atrule">compression</span><span class="token punctuation">:</span>
                <span class="token key atrule">request</span><span class="token punctuation">:</span> <span class="token comment"># è¯·æ±‚å‹ç¼©</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">response</span><span class="token punctuation">:</span> <span class="token comment"># å“åº”å‹ç¼©</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token key atrule">min-request-size</span><span class="token punctuation">:</span> <span class="token number">2024</span>  <span class="token comment">#æœ€å°è§¦å‘å‹ç¼©çš„å¤§å°</span>
                    <span class="token key atrule">mime-types</span><span class="token punctuation">:</span> text/xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">,</span>application/json  <span class="token comment">#è§¦å‘å‹ç¼©æ•°æ®ç±»å‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5ã€æ—¥å¿—æ‰“å°åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_5ã€æ—¥å¿—æ‰“å°åŠŸèƒ½"><span>5ã€æ—¥å¿—æ‰“å°åŠŸèƒ½</span></a></h5><p>Feign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feign ä¸­ Http è¯·æ±‚çš„ç»†èŠ‚ï¼Œè¯´ç™½äº†å°±æ˜¯å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</p><blockquote><p>æ—¥å¿—çº§åˆ«</p><p>NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ï¼›</p><p>BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ï¼›</p><p>HEADERSï¼šé™¤äº† BASIC ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ï¼›</p><p>FULLï¼šé™¤äº† HEADERS ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</p></blockquote><p>åœ¨FeignConfigä¸­æ³¨å†Œ</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLoggerLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡æ˜å“ªä¸ªæ¥å£éœ€è¦æ‰“å°ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># å…¬å¼(ä¸‰æ®µ)ï¼šlogging.level + å«æœ‰@FeignClientæ³¨è§£çš„å®Œæ•´å¸¦åŒ…åçš„æ¥å£å+debug</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
    <span class="token key atrule">level</span><span class="token punctuation">:</span>
        <span class="token key atrule">com</span><span class="token punctuation">:</span>
            <span class="token key atrule">atguigu</span><span class="token punctuation">:</span>
                <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
                    <span class="token key atrule">feignService</span><span class="token punctuation">:</span>
                        <span class="token key atrule">PayFeignApi</span><span class="token punctuation">:</span> debug 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="/assets/img/image-20240404193126160.732ebf96.png" alt="image-20240404193126160" tabindex="0" loading="lazy"><figcaption>image-20240404193126160</figcaption></figure><h2 id="å››ã€ç†”æ–­é™çº§" tabindex="-1"><a class="header-anchor" href="#å››ã€ç†”æ–­é™çº§"><span>å››ã€ç†”æ–­é™çº§</span></a></h2><p>å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†<code>ä¸å¯é¿å…åœ°å¤±è´¥</code></p><p>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ <strong>â€œæ‰‡å‡ºâ€</strong>ã€‚<strong>å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€.</strong></p><p><strong>è§£å†³æ–¹æ³•</strong></p><blockquote><p>æœ‰é—®é¢˜çš„èŠ‚ç‚¹ï¼Œå¿«é€Ÿç†”æ–­ï¼ˆå¿«é€Ÿè¿”å›å¤±è´¥å¤„ç†æˆ–è€…è¿”å›é»˜è®¤å…œåº•æ•°æ®ã€æœåŠ¡é™çº§ã€‘ï¼‰ã€‚</p></blockquote><h3 id="_4-1-æ¦‚å¿µä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_4-1-æ¦‚å¿µä»‹ç»"><span>4.1 æ¦‚å¿µä»‹ç»</span></a></h3><p><strong>é™çº§</strong></p><p>ç®€å•æ¥è¯´å°±æ˜¯æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œè¿”å›ç»™ç”¨æˆ·ä¸€ä¸ªå‹å¥½æç¤ºï¼Œä¾‹å¦‚ æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>ç¨‹åºè¿è¡Œå¼‚å¸¸ã€è¶…æ—¶ã€æœåŠ¡ç†”æ–­è§¦å‘é™çº§ã€çº¿ç¨‹æ± æ‰“æ»¡</code> éƒ½ä¼šè§¦å‘é™çº§ï¼</p><p><strong>ç†”æ–­</strong></p><p>åœ¨äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› è®¿é—®å‹åŠ›è¿‡å¤§è€Œå“åº”å˜æ…¢æˆ–å¤±è´¥ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œå¯ä»¥æš‚æ—¶åˆ‡æ–­å¯¹ä¸‹æ¸¸æœåŠ¡çš„è°ƒç”¨ã€‚ <strong>è¿™ç§ç‰ºç‰²å±€éƒ¨ï¼Œä¿å…¨æ•´ä½“çš„æªæ–½å°±å«åšç†”æ–­ã€‚</strong></p><figure><img src="/assets/img/image-20240404224526487.fbcce97b.png" alt="image-20240404224526487" tabindex="0" loading="lazy"><figcaption>image-20240404224526487</figcaption></figure><p>ä¸€æ—¦ä¸‹æ¸¸æœåŠ¡Cå› æŸäº›åŸå› å˜å¾—ä¸å¯ç”¨ï¼Œç§¯å‹äº†å¤§é‡è¯·æ±‚ï¼ŒæœåŠ¡Bçš„è¯·æ±‚çº¿ç¨‹ä¹Ÿéšä¹‹é˜»å¡ã€‚çº¿ç¨‹èµ„æºé€æ¸è€—å°½ï¼Œä½¿å¾—æœåŠ¡Bä¹Ÿå˜å¾—ä¸å¯ç”¨ã€‚ç´§æ¥ç€ï¼ŒæœåŠ¡ Aä¹Ÿå˜ä¸ºä¸å¯ç”¨ï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯è¢«æ‹–å®ã€‚</p><p>å› æ­¤ï¼Œéœ€è¦æœåŠ¡ç†”æ–­æ¥ç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§</p><p><strong>é™æµ</strong></p><p>ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ</p><h3 id="_4-2-resilience4j" tabindex="-1"><a class="header-anchor" href="#_4-2-resilience4j"><span>4.2 Resilience4J</span></a></h3><h4 id="_4-2-1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_4-2-1-ä»‹ç»"><span>4.2.1 ä»‹ç»</span></a></h4><blockquote><p>Circuit breakeræä¾›äº†è·¨ä¸åŒæ–­è·¯å™¨å®ç°çš„æŠ½è±¡, å®ƒæä¾›äº†ä¸€è‡´çš„ API ä¾›æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨.</p><p>è€Œ Resilience4J æ­£æ˜¯Circuit breakerçš„å®ç°ï¼</p><p>Resilience4j æ˜¯ä¸€ä¸ªç”¨äº<code>å¸®åŠ©æ„å»ºå¼¹æ€§</code>å’Œ<code>å®¹é”™æ€§</code>åº”ç”¨ç¨‹åºçš„ Java åº“ã€‚å®ƒæä¾›äº†ä¸€ç»„å·¥å…·å’Œæ¨¡å¼ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´å®¹æ˜“åœ°ç¼–å†™å¯é ã€é«˜å¯ç”¨çš„åº”ç”¨ç¨‹åºã€‚</p></blockquote><figure><img src="/assets/img/image-20240404222812716.581d1e18.png" alt="image-20240404222812716" tabindex="0" loading="lazy"><figcaption>image-20240404222812716</figcaption></figure><p><strong>ä½œç”¨</strong></p><ul><li><strong>resilience4j-circuitbreaker: Circuit breakingï¼ˆæ–­è·¯ï¼‰</strong></li><li><strong>resilience4j-ratelimiter: Rate limiting ï¼ˆé™æµï¼‰</strong></li><li><strong>resilience4j-bulkhead: Bulkheading ï¼ˆéš”ç¦»ï¼‰</strong></li><li>resilience4j-retry: Automatic retrying (sync and async) ï¼ˆè‡ªåŠ¨é‡è¯•ï¼‰</li><li>resilience4j-timelimiter: Timeout handling ï¼ˆè¶…æ—¶å¤„ç†ï¼‰</li><li>resilience4j-cache: Result caching ï¼ˆç»“æœç¼“å­˜ï¼‰</li></ul><h4 id="_4-2-2-ç†”æ–­æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_4-2-2-ç†”æ–­æœºåˆ¶"><span>4.2.2 ç†”æ–­æœºåˆ¶</span></a></h4><div class="hint-container tip"><p class="hint-container-title">ä¸­æ–‡æ–‡æ¡£</p><p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/CircuitBreaker.md" target="_blank" rel="noopener noreferrer">https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/CircuitBreaker.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p><strong>é¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©ã€‚ç†”æ–­é™çº§ä½œä¸ºä¿æŠ¤è‡ªèº«çš„æ‰‹æ®µï¼Œé€šå¸¸åœ¨å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ç«¯ï¼‰è¿›è¡Œé…ç½®</strong>ã€‚</p><p><code>æ–­è·¯å™¨(Circuit Breaker)</code>æ˜¯ç†”æ–­æœºåˆ¶çš„ä¸€ç§å®ç°æ–¹å¼ã€‚å®ƒæ˜¯ç†”æ–­æœºåˆ¶çš„<code>å…·ä½“å®ç°</code>ï¼Œç±»ä¼¼äºç”µè·¯ä¸­çš„æ–­è·¯å™¨ï¼Œç”¨äºç›‘æ§å¯¹ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚å½“ä¾èµ–æœåŠ¡çš„æ•…éšœç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šåˆ‡æ¢åˆ°<code>å¼€å¯çŠ¶æ€</code>ï¼Œé˜»æ­¢å¯¹è¯¥æœåŠ¡çš„è¯·æ±‚ï¼Œä»è€Œé˜²æ­¢æ•…éšœçš„ä¼ æ’­ã€‚åœ¨å¼€å¯çŠ¶æ€ä¸‹ï¼Œæ–­è·¯å™¨ä¼šæš‚æ—¶æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´åå°è¯•é‡æ–°è¯·æ±‚ä¾èµ–æœåŠ¡ã€‚å¦‚æœè¿™æ¬¡è¯·æ±‚æˆåŠŸï¼Œæ–­è·¯å™¨ä¼šæ¢å¤åˆ°<code>å…³é—­çŠ¶æ€</code>ï¼Œç»§ç»­å…è®¸è¯·æ±‚é€šè¿‡ï¼›</p><p><strong>æ–­è·¯å™¨çš„çŠ¶æ€</strong></p><ul><li><code>å…³é—­(CLOSE)</code><ul><li>æ–­è·¯å™¨å…³é—­æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚å‡å¯é€šè¿‡ï¼Œå±äºæ­£å¸¸çŠ¶æ€</li></ul></li><li><code>å¼€å¯(OPEN)</code><ul><li>å½“è¯·æ±‚çš„å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„<code>é˜ˆå€¼</code>åï¼Œæ–­è·¯å™¨å°±ä¼šç”± å…³é—­è½¬æ¢ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¹¶æ‹’ç»æ‰€æœ‰è¯·æ±‚ã€‚</li></ul></li><li><code>åŠå¼€(HALF_OPEN)</code><ul><li>æ–­è·¯å¼€å¯ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œä¼šè½¬æ¢åˆ° <code>åŠå¼€</code> çŠ¶æ€ ï¼Œ å¹¶å…è®¸é€šè¿‡ä¸€å®šæ•°é‡çš„è¯·æ±‚ï¼Œå°è¯•<code>é‡æ–°è®¡ç®—å¤±è´¥ç‡</code> , å¦‚æœå¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼ï¼Œä»ç„¶ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦åˆ™å˜ä¸ºå…³é—­çŠ¶æ€ï¼</li></ul></li><li>ç¦ç”¨ï¼ˆDISABLEï¼‰ <ul><li>å§‹ç»ˆå…è®¸è®¿é—®</li></ul></li><li>å¼ºåˆ¶å¼€å¯ï¼ˆFORCED_OPENï¼‰ <ul><li>å§‹ç»ˆæ‹’ç»è®¿é—®</li></ul></li></ul><p><strong>æ–­è·¯å™¨ä½¿ç”¨æ»‘åŠ¨çª—å£æ¥ç»Ÿè®¡è°ƒç”¨ç»“æœï¼Œæœ‰ä¿©ç§è®¡ç®—<code>é˜ˆå€¼</code>çš„æ–¹å¼</strong></p><ul><li>åŸºäºè°ƒç”¨æ•°é‡çš„æ»‘åŠ¨çª—å£ï¼š ç»Ÿè®¡æœ€è¿‘Næ¬¡çš„è°ƒç”¨ç»“æœ</li><li>åŸºäºæ—¶é—´çš„æ»‘åŠ¨çª—å£ï¼š ç»Ÿè®¡æœ€è¿‘Nç§’çš„è°ƒç”¨ç»“æœ</li></ul><h5 id="_1ã€æ–­è·¯å™¨é…ç½®å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_1ã€æ–­è·¯å™¨é…ç½®å‚æ•°"><span>1ã€æ–­è·¯å™¨é…ç½®å‚æ•°</span></a></h5><table><thead><tr><th><strong>failure-rate-threshold</strong></th><th><strong>ä»¥ç™¾åˆ†æ¯”é…ç½®å¤±è´¥ç‡å³°å€¼</strong></th></tr></thead><tbody><tr><td><strong>sliding-window-type</strong></td><td><strong>æ–­è·¯å™¨çš„æ»‘åŠ¨çª—å£æœŸç±»å‹ å¯ä»¥åŸºäºâ€œæ¬¡æ•°â€ï¼ˆCOUNT_BASEDï¼‰æˆ–è€…â€œæ—¶é—´â€ï¼ˆTIME_BASEDï¼‰è¿›è¡Œç†”æ–­ï¼Œé»˜è®¤æ˜¯COUNT_BASEDã€‚</strong></td></tr><tr><td><strong>sliding-window-size</strong></td><td><strong>è‹¥COUNT_BASEDï¼Œåˆ™10æ¬¡è°ƒç”¨ä¸­æœ‰50%å¤±è´¥ï¼ˆå³5æ¬¡ï¼‰æ‰“å¼€ç†”æ–­æ–­è·¯å™¨ï¼›è‹¥ä¸ºTIME_BASEDåˆ™ï¼Œæ­¤æ—¶è¿˜æœ‰é¢å¤–çš„ä¸¤ä¸ªè®¾ç½®å±æ€§ï¼Œå«ä¹‰ä¸ºï¼šåœ¨Nç§’å†…ï¼ˆsliding-window-sizeï¼‰100%ï¼ˆslow-call-rate-thresholdï¼‰çš„è¯·æ±‚è¶…è¿‡Nç§’ï¼ˆslow-call-duration-thresholdï¼‰æ‰“å¼€æ–­è·¯å™¨</strong></td></tr><tr><td><strong>slowCallRateThreshold</strong></td><td><strong>ä»¥ç™¾åˆ†æ¯”çš„æ–¹å¼é…ç½®ï¼Œæ–­è·¯å™¨æŠŠè°ƒç”¨æ—¶é—´å¤§äºslowCallDurationThresholdçš„è°ƒç”¨è§†ä¸ºæ…¢è°ƒç”¨ï¼Œå½“æ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºç­‰äºå³°å€¼æ—¶ï¼Œæ–­è·¯å™¨å¼€å¯ï¼Œå¹¶è¿›å…¥æœåŠ¡é™çº§ã€‚</strong></td></tr><tr><td><strong>slowCallDurationThreshold</strong></td><td><strong>é…ç½®è°ƒç”¨æ—¶é—´çš„å³°å€¼ï¼Œé«˜äºè¯¥å³°å€¼çš„è§†ä¸ºæ…¢è°ƒç”¨ã€‚</strong></td></tr><tr><td><strong>permitted-number-of-calls-in-half-open-state</strong></td><td><strong>è¿è¡Œæ–­è·¯å™¨åœ¨HALF_OPENçŠ¶æ€ä¸‹æ—¶è¿›è¡ŒNæ¬¡è°ƒç”¨ï¼Œå¦‚æœæ•…éšœæˆ–æ…¢é€Ÿè°ƒç”¨ä»ç„¶é«˜äºé˜ˆå€¼ï¼Œæ–­è·¯å™¨å†æ¬¡è¿›å…¥æ‰“å¼€çŠ¶æ€ã€‚</strong></td></tr><tr><td><strong>minimum-number-of-calls</strong></td><td><strong>åœ¨æ¯ä¸ªæ»‘åŠ¨çª—å£æœŸæ ·æœ¬æ•°ï¼Œé…ç½®æ–­è·¯å™¨è®¡ç®—é”™è¯¯ç‡æˆ–è€…æ…¢è°ƒç”¨ç‡çš„æœ€å°è°ƒç”¨æ•°ã€‚æ¯”å¦‚è®¾ç½®ä¸º5æ„å‘³ç€ï¼Œåœ¨è®¡ç®—æ•…éšœç‡ä¹‹å‰ï¼Œå¿…é¡»è‡³å°‘è°ƒç”¨5æ¬¡ã€‚å¦‚æœåªè®°å½•äº†4æ¬¡ï¼Œå³ä½¿4æ¬¡éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šè¿›å…¥åˆ°æ‰“å¼€çŠ¶æ€ã€‚</strong></td></tr><tr><td><strong>wait-duration-in-open-state</strong></td><td><strong>ä»OPENåˆ°HALF_OPENçŠ¶æ€éœ€è¦ç­‰å¾…çš„æ—¶é—´</strong></td></tr></tbody></table><h5 id="_2ã€åŸºäºè°ƒç”¨æ•°é‡ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_2ã€åŸºäºè°ƒç”¨æ•°é‡ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º"><span>2ã€åŸºäºè°ƒç”¨æ•°é‡ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º</span></a></h5><blockquote><p><strong>æ–­è·¯å™¨åº”è¯¥é…ç½®åœ¨å“ªä¸ªæ¨¡å—ï¼Ÿ</strong></p><p>é…ç½®åœ¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æ–¹ï¼æˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³ï¼Œæ–­è·¯å™¨ç›¸å½“äºå®¶åº­çš„ä¿é™©ä¸ï¼Œå®¢æˆ·ç«¯å°±ç›¸å½“äºå®¶é‡Œçš„ç”µå™¨(è°ƒç”¨æ–¹)ï¼Œ æœåŠ¡ç«¯å°±ç›¸å½“äº å›½å®¶ç”µç½‘ (è¢«è°ƒç”¨æ–¹)ã€‚</p></blockquote><p><code>cloud-provider-payment8001</code> æ¨¡å—æ¨¡å—æ–°å»ºä¸€ä¸ª <code>PayCircuitController</code> ï¼Œå¹¶ä¸”é€šè¿‡OpenFeign æš´éœ²å‡ºå»</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayCircuitController</span>
<span class="token punctuation">{</span>
    <span class="token comment">//=========Resilience4j CircuitBreaker çš„ä¾‹å­</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;----circuit id ä¸èƒ½è´Ÿæ•°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello, circuit! inputId:  &quot;</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">&quot; \t &quot;</span> <span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>cloud-api-commons</code> æ¨¡å—</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Resilience4j CircuitBreaker çš„ä¾‹å­
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯ <code>cloud-consumer-feign-order80</code> æ¨¡å—é…ç½®ç†”æ–­æœºåˆ¶ã€‚</p><p><strong>å¢åŠ ä¾èµ–</strong>ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!--resilience4j-circuitbreaker--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-circuitbreaker-resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ç”±äºæ–­è·¯ä¿æŠ¤ç­‰éœ€è¦AOPå®ç°ï¼Œæ‰€ä»¥å¿…é¡»å¯¼å…¥AOPåŒ… --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yamlé…ç½®</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">openfeign</span><span class="token punctuation">:</span>
            <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
       			 <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
       			 <span class="token key atrule">group</span><span class="token punctuation">:</span>
          			<span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#æ²¡å¼€åˆ†ç»„æ°¸è¿œä¸ç”¨åˆ†ç»„çš„é…ç½®ã€‚ç²¾ç¡®ä¼˜å…ˆã€åˆ†ç»„æ¬¡ä¹‹(å¼€äº†åˆ†ç»„)ã€é»˜è®¤æœ€å</span>
          			
<span class="token comment"># Resilience4j CircuitBreaker æŒ‰ç…§æ¬¡æ•°ï¼šCOUNT_BASED çš„ä¾‹å­</span>
<span class="token comment">#  6æ¬¡è®¿é—®ä¸­å½“æ‰§è¡Œæ–¹æ³•çš„å¤±è´¥ç‡è¾¾åˆ°50%æ—¶CircuitBreakerå°†è¿›å…¥å¼€å¯OPENçŠ¶æ€(ä¿é™©ä¸è·³é—¸æ–­ç”µ)æ‹’ç»æ‰€æœ‰è¯·æ±‚ã€‚</span>
<span class="token comment">#  ç­‰å¾…5ç§’åï¼ŒCircuitBreaker å°†è‡ªåŠ¨ä»å¼€å¯OPENçŠ¶æ€è¿‡æ¸¡åˆ°åŠå¼€HALF_OPENçŠ¶æ€ï¼Œå…è®¸ä¸€äº›è¯·æ±‚é€šè¿‡ä»¥æµ‹è¯•æœåŠ¡æ˜¯å¦æ¢å¤æ­£å¸¸ã€‚</span>
<span class="token comment">#  å¦‚è¿˜æ˜¯å¼‚å¸¸CircuitBreaker å°†é‡æ–°è¿›å…¥å¼€å¯OPENçŠ¶æ€ï¼›å¦‚æ­£å¸¸å°†è¿›å…¥å…³é—­CLOSEé—­åˆçŠ¶æ€æ¢å¤æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
<span class="token comment">#è®¾ç½®50%çš„è°ƒç”¨å¤±è´¥æ—¶æ‰“å¼€æ–­è·¯å™¨ï¼Œè¶…è¿‡å¤±è´¥è¯·æ±‚ç™¾åˆ†â½CircuitBreakerå˜ä¸ºOPENçŠ¶æ€</span>
                <span class="token key atrule">failureRateThreshold</span><span class="token punctuation">:</span> 50 ã€‚
                <span class="token comment"># æ»‘åŠ¨çª—å£çš„ç±»å‹</span>
                <span class="token key atrule">slidingWindowType</span><span class="token punctuation">:</span> COUNT_BASED 
<span class="token comment">#æ»‘åŠ¨çª—â¼çš„â¼¤â¼©é…ç½®COUNT_BASEDè¡¨ç¤º6ä¸ªè¯·æ±‚ï¼Œé…ç½®TIME_BASEDè¡¨ç¤º6ç§’</span>
                <span class="token key atrule">slidingWindowSize</span><span class="token punctuation">:</span> <span class="token number">6</span> 
<span class="token comment">#æ–­è·¯å™¨è®¡ç®—å¤±è´¥ç‡æˆ–æ…¢è°ƒç”¨ç‡ä¹‹å‰æ‰€éœ€çš„æœ€å°æ ·æœ¬(æ¯ä¸ªæ»‘åŠ¨çª—å£å‘¨æœŸ)ã€‚å¦‚æœminimumNumberOfCallsä¸º10ï¼Œåˆ™å¿…é¡»æœ€å°‘è®°å½•10ä¸ªæ ·æœ¬ï¼Œç„¶åæ‰èƒ½è®¡ç®—å¤±è´¥ç‡ã€‚å¦‚æœåªè®°å½•äº†9æ¬¡è°ƒç”¨ï¼Œå³ä½¿æ‰€æœ‰9æ¬¡è°ƒç”¨éƒ½å¤±è´¥ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šå¼€å¯ã€‚            </span>
                <span class="token key atrule">minimumNumberOfCalls</span><span class="token punctuation">:</span> <span class="token number">6</span>
<span class="token comment"># æ˜¯å¦å¯ç”¨è‡ªåŠ¨ä»å¼€å¯çŠ¶æ€è¿‡æ¸¡åˆ°åŠå¼€çŠ¶æ€ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚å¦‚æœå¯ç”¨ï¼ŒCircuitBreakerå°†è‡ªåŠ¨ä»å¼€å¯çŠ¶æ€è¿‡æ¸¡åˆ°åŠå¼€çŠ¶æ€ï¼Œå¹¶å…è®¸ä¸€äº›è¯·æ±‚é€šè¿‡ä»¥æµ‹è¯•æœåŠ¡æ˜¯å¦æ¢å¤æ­£å¸¸</span>
                <span class="token key atrule">automaticTransitionFromOpenToHalfOpenEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> 
<span class="token comment">#ä»OPENåˆ°HALF_OPENçŠ¶æ€éœ€è¦ç­‰å¾…çš„æ—¶é—´</span>
                <span class="token key atrule">waitDurationInOpenState</span><span class="token punctuation">:</span> 5s 
<span class="token comment">#åŠå¼€çŠ¶æ€å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤å€¼ä¸º10ã€‚åœ¨åŠå¼€çŠ¶æ€ä¸‹ï¼ŒCircuitBreakerå°†å…è®¸æœ€å¤špermittedNumberOfCallsInHalfOpenStateä¸ªè¯·æ±‚é€šè¿‡ï¼Œå¦‚æœå…¶ä¸­æœ‰ä»»ä½•ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼ŒCircuitBreakerå°†é‡æ–°è¿›å…¥å¼€å¯çŠ¶æ€ã€‚</span>
                <span class="token key atrule">permittedNumberOfCallsInHalfOpenState</span><span class="token punctuation">:</span> <span class="token number">2</span> 
                <span class="token key atrule">recordExceptions</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> java.lang.Exception  <span class="token comment"># è®¡å…¥å¤±è´¥çš„å¼‚å¸¸</span>
        <span class="token key atrule">instances</span><span class="token punctuation">:</span>
            <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
                <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ›å»ºOrderCircuitController</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderCircuitController</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PayFeignApi</span> payFeignApi<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/circuit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// nameè¦å’Œé…ç½®ä¸­çš„instancesä¿æŒä¸€è‡´</span>
    <span class="token comment">// fallbackMethodå…œåº•æ–¹æ³•ï¼Œå½“æ–­è·¯å™¨å¼€å¯æ—¶ï¼Œè¦ç»™ç”¨æˆ·ä¸€ä¸ªå‹å¥½çš„åé¦ˆï¼</span>
    <span class="token annotation punctuation">@CircuitBreaker</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span> fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myCircuitFallback&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuitBreaker</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myCircuit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//myCircuitFallbackå°±æ˜¯æœåŠ¡é™çº§åçš„å…œåº•å¤„ç†æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myCircuitFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿™é‡Œæ˜¯å®¹é”™å¤„ç†é€»è¾‘ï¼Œè¿”å›å¤‡ç”¨ç»“æœ</span>
        <span class="token keyword">return</span> <span class="token string">&quot;myCircuitFallbackï¼Œç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•-----/(ã„’oã„’)/~~&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><p>æ­£å¸¸çš„è¯·æ±‚ï¼š<a href="http://localhost/feign/pay/circuit/1" target="_blank" rel="noopener noreferrer">localhost/feign/pay/circuit/1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>é”™è¯¯çš„è¯·æ±‚ï¼š<a href="http://localhost/feign/pay/circuit/-4" target="_blank" rel="noopener noreferrer">localhost/feign/pay/circuit/-4<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>åœ¨ PayCircuitControllerä¸­å½“ID = -4 æ—¶ ï¼Œä¼šæŠ›å‡º RuntimeException å¼‚å¸¸ï¼Œåœ¨é…ç½®ä¸­æˆ‘ä»¬é…ç½®äº† <code>recordExceptions</code> ï¼Œ å› æ­¤ä¼šè®¡å…¥å¤±è´¥çš„è¯·æ±‚ï¼ã€‚</p><p>è‹¥å¼‚å¸¸ä¸ç›¸åŒæˆ–è€…ä¸æ˜¯çˆ¶å­ç±»çš„å…³ç³»ï¼Œåˆ™ä¸ä¼šè®¡å…¥ï¼</p></blockquote><p>å½“æˆ‘ä»¬è®¿é—®6æ¬¡ï¼Œé”™è¯¯çš„è¯·æ±‚å  50% æ—¶ï¼Œå°±ä¼šå¼€å¯æ–­è·¯å™¨ï¼Œæ‰§è¡Œfallbackå…œåº•æ–¹æ³•ï¼</p><h5 id="_3ã€åŸºäºè°ƒç”¨æ—¶é—´-ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_3ã€åŸºäºè°ƒç”¨æ—¶é—´-ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º"><span>3ã€åŸºäºè°ƒç”¨æ—¶é—´ ç»Ÿè®¡çš„æ¡ˆä¾‹æ¼”ç¤º</span></a></h5><p>é…ç½®</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># Resilience4j CircuitBreaker æŒ‰ç…§æ—¶é—´ï¼šTIME_BASED çš„ä¾‹å­</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 10s <span class="token comment">#ç¥å‘çš„ä½ç½®ï¼Œtimelimiter é»˜è®¤é™åˆ¶è¿œç¨‹1sï¼Œè¶…äº1så°±è¶…æ—¶å¼‚å¸¸ï¼Œé…ç½®äº†é™çº§ï¼Œå°±èµ°é™çº§é€»è¾‘</span>
    <span class="token key atrule">circuitbreaker</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">failureRateThreshold</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">#è®¾ç½®50%çš„è°ƒç”¨å¤±è´¥æ—¶æ‰“å¼€æ–­è·¯å™¨ï¼Œè¶…è¿‡å¤±è´¥è¯·æ±‚ç™¾åˆ†â½CircuitBreakerå˜ä¸ºOPENçŠ¶æ€ã€‚</span>
                <span class="token key atrule">slowCallDurationThreshold</span><span class="token punctuation">:</span> 2s <span class="token comment">#æ…¢è°ƒç”¨æ—¶é—´é˜ˆå€¼ï¼Œé«˜äºè¿™ä¸ªé˜ˆå€¼çš„è§†ä¸ºæ…¢è°ƒç”¨å¹¶å¢åŠ æ…¢è°ƒç”¨æ¯”ä¾‹ã€‚</span>
                <span class="token key atrule">slowCallRateThreshold</span><span class="token punctuation">:</span> <span class="token number">30</span> <span class="token comment">#æ…¢è°ƒç”¨ç™¾åˆ†æ¯”å³°å€¼ï¼Œæ–­è·¯å™¨æŠŠè°ƒç”¨æ—¶é—´â¼¤äºslowCallDurationThresholdï¼Œè§†ä¸ºæ…¢è°ƒç”¨ï¼Œå½“æ…¢è°ƒç”¨æ¯”ä¾‹é«˜äºé˜ˆå€¼ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œå¹¶å¼€å¯æœåŠ¡é™çº§</span>
                <span class="token key atrule">slidingWindowType</span><span class="token punctuation">:</span> TIME_BASED <span class="token comment"># æ»‘åŠ¨çª—å£çš„ç±»å‹</span>
                <span class="token key atrule">slidingWindowSize</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#æ»‘åŠ¨çª—å£çš„å¤§å°é…ç½®ï¼Œé…ç½®TIME_BASEDè¡¨ç¤º2ç§’</span>
                <span class="token key atrule">minimumNumberOfCalls</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#æ–­è·¯å™¨è®¡ç®—å¤±è´¥ç‡æˆ–æ…¢è°ƒç”¨ç‡ä¹‹å‰æ‰€éœ€çš„æœ€å°æ ·æœ¬(æ¯ä¸ªæ»‘åŠ¨çª—å£å‘¨æœŸ)ã€‚</span>
                <span class="token key atrule">permittedNumberOfCallsInHalfOpenState</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#åŠå¼€çŠ¶æ€å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤å€¼ä¸º10ã€‚</span>
                <span class="token key atrule">waitDurationInOpenState</span><span class="token punctuation">:</span> 5s <span class="token comment">#ä»OPENåˆ°HALF_OPENçŠ¶æ€éœ€è¦ç­‰å¾…çš„æ—¶é—´</span>
                <span class="token key atrule">recordExceptions</span><span class="token punctuation">:</span>
                    <span class="token punctuation">-</span> java.lang.Exception
        <span class="token key atrule">instances</span><span class="token punctuation">:</span>
            <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
                <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-3-éš”ç¦»" tabindex="-1"><a class="header-anchor" href="#_4-2-3-éš”ç¦»"><span>4.2.3 éš”ç¦»</span></a></h4><div class="hint-container tip"><p class="hint-container-title">æ–‡æ¡£</p><p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/bulkhead.md" target="_blank" rel="noopener noreferrer">https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/bulkhead.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p><strong>ä¾èµ–éš”ç¦»&amp;è´Ÿè½½ä¿æŠ¤</strong>ï¼šç”¨æ¥é™åˆ¶å¯¹äºä¸‹æ¸¸æœåŠ¡çš„æœ€å¤§å¹¶å‘æ•°é‡</p><p>Resilience4jæä¾›äº†ä¸¤ç§éš”ç¦»çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥é™åˆ¶å¹¶å‘æ‰§è¡Œçš„æ•°é‡:</p><ul><li><code>SemaphoreBulkhead</code>ä½¿ç”¨äº†ä¿¡å·é‡</li><li><code>FixedThreadPoolBulkhead</code>ä½¿ç”¨äº†æœ‰ç•Œé˜Ÿåˆ—å’Œå›ºå®šå¤§å°çº¿ç¨‹æ± </li></ul><h5 id="_1ã€semaphorebulkhead" tabindex="-1"><a class="header-anchor" href="#_1ã€semaphorebulkhead"><span>1ã€SemaphoreBulkhead</span></a></h5><blockquote><p>è¿™ä¸ªå’Œ<a href="https://blog.csdn.net/aetawt/article/details/128044736" target="_blank" rel="noopener noreferrer">JUC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸­çš„ Semaphore åŸç†æ˜¯ä¸€æ ·çš„ã€‚</p><p>é€šè¿‡<code>ç»´æŒä¸€ç»„è®¸å¯è¯</code> æ¥å®ç°é˜»å¡å’Œé€šè¡Œ</p></blockquote><figure><img src="/assets/img/image-20240405154506118.d736e456.png" alt="image-20240405154506118" tabindex="0" loading="lazy"><figcaption>image-20240405154506118</figcaption></figure><p><strong>å¦‚ä½•ä½¿ç”¨</strong></p><p>å¢åŠ ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--resilience4j-bulkhead--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>resilience4j-bulkhead<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®å‚æ•°</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment">####resilience4j bulkhead çš„ä¾‹å­</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
  <span class="token key atrule">bulkhead</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxConcurrentCalls</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># éš”ç¦»å…è®¸å¹¶å‘çº¿ç¨‹æ‰§è¡Œçš„æœ€å¤§æ•°é‡</span>
        <span class="token key atrule">maxWaitDuration</span><span class="token punctuation">:</span> 1s <span class="token comment"># å½“è¾¾åˆ°å¹¶å‘è°ƒç”¨æ•°é‡æ—¶ï¼Œæ–°çš„çº¿ç¨‹çš„é˜»å¡æ—¶é—´ï¼Œæˆ‘åªæ„¿æ„ç­‰å¾…1ç§’ï¼Œè¿‡æ—¶ä¸å€™è¿›èˆ±å£å…œåº•fallback</span>
    <span class="token key atrule">instances</span><span class="token punctuation">:</span>
      <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
        <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
  <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
    <span class="token key atrule">configs</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 20s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è°ƒç”¨æ–¹çš„Controllerä½¿ç”¨æ³¨è§£ <code>@Bulkhead</code> æ ‡æ³¨ï¼ŒæŒ‡æ˜éš”ç¦»ç±»å‹ä¸ºï¼š<code>Bulkhead.Type.SEMAPHORE</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     *(èˆ¹çš„)èˆ±å£,éš”ç¦»
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Bulkhead</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myBulkheadFallback&quot;</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token class-name">Bulkhead<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">SEMAPHORE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myBulkhead</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkheadFallback</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;myBulkheadFallbackï¼Œéš”æ¿è¶…å‡ºæœ€å¤§æ•°é‡é™åˆ¶ï¼Œç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•-----/(ã„’oã„’)/~~&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2ã€fixedthreadpoolbulkhead" tabindex="-1"><a class="header-anchor" href="#_2ã€fixedthreadpoolbulkhead"><span>2ã€FixedThreadPoolBulkhead</span></a></h5><blockquote><p>è¿™ä¸ªå’Œ<a href="https://blog.csdn.net/aetawt/article/details/128044736" target="_blank" rel="noopener noreferrer">JUC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­çš„ ThreadPool åŸç†æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><figure><img src="/assets/img/image-20240405160342750.54c7ce29.png" alt="image-20240405160342750" tabindex="0" loading="lazy"><figcaption>image-20240405160342750</figcaption></figure><p><strong>å¦‚ä½•ä½¿ç”¨</strong></p><p>ä¾èµ–</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>&lt;!--resilience4j-bulkhead--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;
    &lt;artifactId&gt;resilience4j-bulkhead&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment">####resilience4j bulkhead -THREADPOOLçš„ä¾‹å­</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">timelimiter</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> 10s <span class="token comment">#timelimiteré»˜è®¤é™åˆ¶è¿œç¨‹1sï¼Œè¶…è¿‡æŠ¥é”™ä¸å¥½æ¼”ç¤ºæ•ˆæœæ‰€ä»¥åŠ ä¸Š10ç§’</span>
    <span class="token key atrule">thread-pool-bulkhead</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">core-thread-pool-size</span><span class="token punctuation">:</span> <span class="token number">4</span>   <span class="token comment"># æœ€å¤§çº¿ç¨‹æ•°</span>
                <span class="token key atrule">max-thread-pool-size</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># æ ¸å¿ƒçº¿ç¨‹æ•°</span>
                <span class="token key atrule">queue-capacity</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># ç­‰å¾…é˜Ÿåˆ—</span>
                <span class="token comment"># å¹¶å‘çš„çº¿ç¨‹æ•°ï¼šæœ€å¤§çº¿ç¨‹æ•° + ç­‰å¾…é˜Ÿåˆ— = 6</span>
        <span class="token key atrule">instances</span><span class="token punctuation">:</span>
            <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
                <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è°ƒç”¨æ–¹çš„Controllerä½¿ç”¨æ³¨è§£ <code>@Bulkhead</code> æ ‡æ³¨ï¼ŒæŒ‡æ˜éš”ç¦»ç±»å‹ä¸ºï¼š<code>Bulkhead.Type.THREADPOOL</code></p><p>å¹¶ä¸”<code> FixedThreadPoolBulkhead</code> è¦æ±‚çš„è¿”å›ç±»å‹ä¸º <code>CompletableFuture</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * (èˆ¹çš„)èˆ±å£,éš”ç¦»,THREADPOOL
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/bulkhead/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bulkhead</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myBulkheadPoolFallback&quot;</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token class-name">Bulkhead<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">THREADPOOL</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">myBulkheadTHREADPOOL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;enter the method!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;exist the method!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myBulkhead</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot; Bulkhead.Type.THREADPOOL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">myBulkheadPoolFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Bulkhead.Type.THREADPOOLï¼Œç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•-----/(ã„’oã„’)/~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2-4-é™æµ" tabindex="-1"><a class="header-anchor" href="#_4-2-4-é™æµ"><span>4.2.4 é™æµ</span></a></h4><div class="hint-container tip"><p class="hint-container-title">æ–‡æ¡£</p><p><a href="https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/ratelimiter.md" target="_blank" rel="noopener noreferrer">https://github.com/lmhmhl/Resilience4j-Guides-Chinese/blob/main/core-modules/ratelimiter.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p>ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!--resilience4j-ratelimiter--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.resilience4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>resilience4j-ratelimiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment">####resilience4j ratelimiter é™æµçš„ä¾‹å­</span>
<span class="token key atrule">resilience4j</span><span class="token punctuation">:</span>
    <span class="token key atrule">ratelimiter</span><span class="token punctuation">:</span>
        <span class="token key atrule">configs</span><span class="token punctuation">:</span>
            <span class="token key atrule">default</span><span class="token punctuation">:</span>
                <span class="token key atrule">limitForPeriod</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">#åœ¨ä¸€æ¬¡åˆ·æ–°å‘¨æœŸå†…ï¼Œå…è®¸æ‰§è¡Œçš„æœ€å¤§è¯·æ±‚æ•°</span>
                <span class="token key atrule">limitRefreshPeriod</span><span class="token punctuation">:</span> 1s <span class="token comment"># é™æµå™¨æ¯éš”limitRefreshPeriodåˆ·æ–°ä¸€æ¬¡ï¼Œå°†å…è®¸å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°é‡é‡ç½®ä¸ºlimitForPeriod</span>
                <span class="token key atrule">timeout-duration</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># çº¿ç¨‹ç­‰å¾…æƒé™çš„é»˜è®¤ç­‰å¾…æ—¶é—´</span>
        <span class="token key atrule">instances</span><span class="token punctuation">:</span>
            <span class="token key atrule">cloud-payment-service</span><span class="token punctuation">:</span>
                <span class="token key atrule">baseConfig</span><span class="token punctuation">:</span> default
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>@RateLimiter</code> æ³¨è§£æ ‡æ³¨</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/feign/pay/ratelimit/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RateLimiter</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cloud-payment-service&quot;</span><span class="token punctuation">,</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;myRatelimitFallback&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myBulkhead</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> payFeignApi<span class="token punctuation">.</span><span class="token function">myRatelimit</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myRatelimitFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ä½ è¢«é™æµäº†ï¼Œç¦æ­¢è®¿é—®/(ã„’oã„’)/~~&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª" tabindex="-1"><a class="header-anchor" href="#äº”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª"><span>äº”ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª</span></a></h2><p>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚</p><figure><img src="/assets/img/image-20240405170221197.e153ed83.png" alt="image-20240405170221197" tabindex="0" loading="lazy"><figcaption>image-20240405170221197</figcaption></figure><p>åœ¨åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å®æ—¶è§‚æµ‹ç³»ç»Ÿçš„æ•´ä½“è°ƒç”¨é“¾è·¯æƒ…å†µã€‚</p></li><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å¿«é€Ÿå‘ç°å¹¶å®šä½åˆ°é—®é¢˜ã€‚</p></li><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å°½å¯èƒ½ç²¾ç¡®çš„åˆ¤æ–­æ•…éšœå¯¹ç³»ç»Ÿçš„å½±å“èŒƒå›´ä¸å½±å“ç¨‹åº¦ã€‚</p></li><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å°½å¯èƒ½ç²¾ç¡®çš„æ¢³ç†å‡ºæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶åˆ¤æ–­å‡ºæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯å¦åˆç†ã€‚</p></li><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å°½å¯èƒ½ç²¾ç¡®çš„åˆ†ææ•´ä¸ªç³»ç»Ÿè°ƒç”¨é“¾è·¯çš„æ€§èƒ½ä¸ç“¶é¢ˆç‚¹ã€‚</p></li><li><p>åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ä¸å¾®æœåŠ¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•å°½å¯èƒ½ç²¾ç¡®çš„åˆ†æç³»ç»Ÿçš„å­˜å‚¨ç“¶é¢ˆä¸å®¹é‡è§„åˆ’ã€‚</p></li></ul><h3 id="_5-1-micrometer-zipkin" tabindex="-1"><a class="header-anchor" href="#_5-1-micrometer-zipkin"><span>5.1 Micrometer + Zipkin</span></a></h3><blockquote><p>Micrometer æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ</p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin</p></blockquote><p>ä¸€æ¡é“¾è·¯é€šè¿‡Trace Idå”¯ä¸€æ ‡è¯†ï¼ŒSpanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„spané€šè¿‡parent id å…³è”èµ·æ¥</p><figure><img src="/assets/img/image-20240405171318573.11b87199.png" alt="image-20240405171318573" tabindex="0" loading="lazy"><figcaption>image-20240405171318573</figcaption></figure><h4 id="_5-1-1-ä¸‹è½½-zipkin" tabindex="-1"><a class="header-anchor" href="#_5-1-1-ä¸‹è½½-zipkin"><span>5.1.1 ä¸‹è½½ ZipKin</span></a></h4><p><strong>ä¸‹è½½ zipkinï¼š</strong></p><p><a href="https://zipkin.io/pages/quickstart" target="_blank" rel="noopener noreferrer">https://zipkin.io/pages/quickstart<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>æ‰§è¡Œ jar åŒ…ï¼š</strong></p><p>java -jar zipkin-server-2.12.9-exec.jar</p><p><strong>è®¿é—®ï¼š</strong></p><p><a href="http://localhost:9411/zipkin/" target="_blank" rel="noopener noreferrer">http://localhost:9411/zipkin/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_5-1-2-æ­å»ºé“¾è·¯ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#_5-1-2-æ­å»ºé“¾è·¯ç›‘æ§"><span>5.1.2 æ­å»ºé“¾è·¯ç›‘æ§</span></a></h4><p>1ã€çˆ¶å·¥ç¨‹å¼•å…¥</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micrometer-tracing.version</span><span class="token punctuation">&gt;</span></span>1.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micrometer-tracing.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micrometer-observation.version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micrometer-observation.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feign-micrometer.version</span><span class="token punctuation">&gt;</span></span>12.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feign-micrometer.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zipkin-reporter-brave.version</span><span class="token punctuation">&gt;</span></span>2.17.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>zipkin-reporter-brave.version</span><span class="token punctuation">&gt;</span></span>




<span class="token comment">&lt;!--micrometer-tracing-bomå¯¼å…¥é“¾è·¯è¿½è¸ªç‰ˆæœ¬ä¸­å¿ƒ  1--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--micrometer-tracingæŒ‡æ ‡è¿½è¸ª  2--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--micrometer-tracing-bridge-braveé€‚é…zipkinçš„æ¡¥æ¥åŒ… 3--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-tracing.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--micrometer-observation 4--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-observation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${micrometer-observation.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--feign-micrometer 5--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${feign-micrometer.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--zipkin-reporter-brave 6--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.zipkin.reporter2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zipkin-reporter-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${zipkin-reporter-brave.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å­å·¥ç¨‹å¼•å…¥ä»¥ä¸‹äº”ä¸ªå³å¯</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>        <span class="token comment">&lt;!--micrometer-tracingæŒ‡æ ‡è¿½è¸ª  1--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--micrometer-tracing-bridge-braveé€‚é…zipkinçš„æ¡¥æ¥åŒ… 2--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-tracing-bridge-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--micrometer-observation 3--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-observation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--feign-micrometer 4--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--zipkin-reporter-brave 5--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.zipkin.reporter2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zipkin-reporter-brave<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€é…ç½®ï¼Œå“ªä¸ªæœåŠ¡éœ€è¦ç›‘æ§å°±é…ç½®å“ªä¸ªæœåŠ¡ï¼</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># ========================zipkin===================</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
    <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
        <span class="token key atrule">tracing</span><span class="token punctuation">:</span>
            <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9411/api/v2/spans
    <span class="token key atrule">tracing</span><span class="token punctuation">:</span>
        <span class="token key atrule">sampling</span><span class="token punctuation">:</span>
            <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1.0</span> <span class="token comment">#é‡‡æ ·ç‡é»˜è®¤ä¸º0.1(0.1å°±æ˜¯10æ¬¡åªèƒ½æœ‰ä¸€æ¬¡è¢«è®°å½•ä¸‹æ¥)ï¼Œå€¼è¶Šå¤§æ”¶é›†è¶ŠåŠæ—¶ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…­ã€gateway-ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#å…­ã€gateway-ç½‘å…³"><span>å…­ã€Gateway ç½‘å…³</span></a></h2><blockquote><p><strong>ä»€ä¹ˆæ˜¯ç½‘å…³ï¼Ÿ</strong></p></blockquote><p>ç½‘å…³çš„è§’è‰²æ˜¯ä½œä¸ºä¸€ä¸ª API æ¶æ„ï¼Œç”¨æ¥ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®</p><blockquote><p><strong>GateWay å’Œ Nginxéƒ½ä½œä¸ºç½‘å…³ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p></blockquote><figure><img src="/assets/img/image-20240405215124906.cb5dcf03.png" alt="image-20240405215124906" tabindex="0" loading="lazy"><figcaption>image-20240405215124906</figcaption></figure><p>é€šå¸¸å¯ä»¥å°†Nginxè‡³äº Gateway ç½‘å…³å‰ï¼Œè´Ÿè´£å¯¹ Gateway ç½‘å…³çš„è´Ÿè½½å‡è¡¡ï¼Œç„¶åå†ç”±ç½‘å…³å†³å®šè¿›å…¥æ ¹æ®åˆ¤å®šåˆ°å“ªä¸ªçœŸå®çš„web æœåŠ¡å™¨ã€‚ è®©ä¸¤è€…çš„åˆ†å·¥æ›´åŠ æ˜ç¡®ï¼Œä¹Ÿå°±æ˜¯ï¼š<strong>Gateway ç½‘å…³èšåˆæœåŠ¡ï¼ŒNginxè¯·æ±‚è½¬å‘</strong></p><h3 id="_6-1-gateway-ä¸‰å¤§æ ¸å¿ƒ" tabindex="-1"><a class="header-anchor" href="#_6-1-gateway-ä¸‰å¤§æ ¸å¿ƒ"><span>6.1 Gateway ä¸‰å¤§æ ¸å¿ƒ</span></a></h3><ul><li><strong>Routeï¼ˆè·¯ç”±ï¼‰</strong>: è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</li><li><strong>Predicateï¼ˆè°“è¯ï¼‰</strong>: å‚è€ƒçš„æ˜¯Java8çš„ <code>java.util.function.Predicate</code> å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</li><li><strong>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</strong>: è¿™äº›æ˜¯ <a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/GatewayFilter.java" target="_blank" rel="noopener noreferrer"><code>GatewayFilter</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„å®ä¾‹ï¼Œå·²ç»ç”¨ç‰¹å®šå·¥å‚æ„å»ºã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚</li></ul><p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p><figure><img src="/assets/img/spring_cloud_gateway_diagram.24a8fc12.png" alt="Spring Cloud Gateway Diagram" tabindex="0" loading="lazy"><figcaption>Spring Cloud Gateway Diagram</figcaption></figure><ul><li>å®¢æˆ·ç«¯å‘ <code>Spring Cloud Gateway</code> å‘å‡ºè¯·æ±‚ã€‚</li><li>å¦‚æœ <code>Gateway Handler Mapping</code> æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° <code>Gateway Web Handler</code>ã€‚</li><li>Handler å†é€šè¿‡æŒ‡å®šçš„ <strong>è¿‡æ»¤å™¨é“¾</strong> æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</li><li>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</li></ul><blockquote><p>æ ¸å¿ƒå°±æ˜¯ï¼š <code>Gateway Handler Mapping</code> ã€<code>Gateway Web Handler</code>ã€<code>Fileter Chian</code></p><p>æœ‰ç‚¹ç±»ä¼¼äºSpringMVCçš„æ‰§è¡Œæµç¨‹</p></blockquote><h3 id="_6-2-ç®€å•é…ç½®" tabindex="-1"><a class="header-anchor" href="#_6-2-ç®€å•é…ç½®"><span>6.2 ç®€å•é…ç½®</span></a></h3><blockquote><p>ç½‘å…³ä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡æ¨¡å—ï¼Œå› æ­¤éœ€è¦å•ç‹¬çš„åˆ›å»º <code>ç½‘å…³æ¨¡å—</code></p></blockquote><p>1ã€åˆ›å»ºç½‘å…³æœåŠ¡æ¨¡å—</p><figure><img src="/assets/img/image-20240405220811768.a9cce681.png" alt="image-20240405220811768" tabindex="0" loading="lazy"><figcaption>image-20240405220811768</figcaption></figure><p>2ã€POM</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--gateway--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æœåŠ¡æ³¨å†Œå‘ç°consul discovery,ç½‘å…³ä¹Ÿè¦æ³¨å†Œè¿›æœåŠ¡æ³¨å†Œä¸­å¿ƒç»Ÿä¸€ç®¡æ§--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- æŒ‡æ ‡ç›‘æ§å¥åº·æ£€æŸ¥çš„actuator,ç½‘å…³æ˜¯å“åº”å¼ç¼–ç¨‹åˆ é™¤æ‰spring-boot-starter-web dependency--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>gateway <span class="token comment">#ä»¥å¾®æœåŠ¡æ³¨å†Œè¿›consulæˆ–nacosæœåŠ¡åˆ—è¡¨å†…</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">consul</span><span class="token punctuation">:</span> <span class="token comment">#é…ç½®consulåœ°å€</span>
            <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
            <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
            <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
                <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>
                
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
<span class="token comment">#è·¯ç”±çš„ID(ç±»ä¼¼mysqlä¸»é”®ID)ï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 <span class="token comment">#pay_routh1       </span>
				 <span class="token comment"># è·¯ç”±åœ°å€ï¼šlbè¡¨ç¤ºè´Ÿè½½å‡è¡¡LoadBalance</span>
                 <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/get/<span class="token important">**</span>              
                
                
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh2 <span class="token comment">#pay_routh2                </span>
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service           
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/info/<span class="token important">**</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€å¯åŠ¨ç±»</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main9527</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main9527</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ­¤æ—¶è®¿é—® 9527 ç«¯å£ï¼Œç½‘å…³å°±èƒ½å¤Ÿæ›¿æˆ‘ä»¬è½¬å‘åˆ° <code>8001</code> ç«¯å£</p></blockquote><h3 id="_6-3-é«˜çº§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_6-3-é«˜çº§ç‰¹æ€§"><span>6.3 é«˜çº§ç‰¹æ€§</span></a></h3><h4 id="_6-3-1-predicateæ–­è¨€" tabindex="-1"><a class="header-anchor" href="#_6-3-1-predicateæ–­è¨€"><span>6.3.1 Predicateæ–­è¨€</span></a></h4><div class="hint-container tip"><p class="hint-container-title">ä¸­æ–‡æ–‡æ¡£</p><p><a href="https://springdoc.cn/spring-cloud-gateway/" target="_blank" rel="noopener noreferrer">https://springdoc.cn/spring-cloud-gateway/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><p><strong>GateWayè‡ªå¸¦çš„RoutePredicateFactory</strong></p><figure><img src="/assets/img/image-20240406093526625.f272f91d.png" alt="image-20240406093526625" tabindex="0" loading="lazy"><figcaption>image-20240406093526625</figcaption></figure><p>Spring Cloud Gatewayå°†è·¯ç”±åŒ¹é…ä½œä¸ºSpring WebFlux <code>HandlerMapping</code> åŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†ã€‚Spring Cloud GatewayåŒ…æ‹¬è®¸å¤šå†…ç½®çš„ <code>RoutePredicateFactory</code>ã€‚æ‰€æœ‰è¿™äº›<code>Predicate</code>éƒ½ä¸HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ç›¸åŒ¹é…ã€‚ä½ å¯ä»¥ç”¨é€»è¾‘ <code>and</code> è¯­å¥ç»„åˆå¤šä¸ªRoutePredicateFactoryã€‚</p><p>æœ‰ä¸¤ç§æ–¹å¼æ¥é…ç½®è°“è¯å’Œè¿‡æ»¤å™¨ï¼š<code>å¿«æ·æ–¹å¼</code>å’Œ<code>å®Œå…¨å±•å¼€</code>çš„å‚æ•°</p><ul><li><strong>å¿«æ·æ–¹å¼</strong>ï¼šè¿‡æ»¤å™¨åç§°ï¼ˆfilter nameï¼‰åé¢è·Ÿä¸€ä¸ªç­‰å· (<code>=</code>)ï¼Œç„¶åæ˜¯ç”¨é€—å· (<code>,</code>) åˆ†éš”çš„å‚æ•°å€¼ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Cookie=mycookie<span class="token punctuation">,</span>mycookievalue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>å®Œå…¨å±•å¼€</strong>ï¼šå®Œå…¨å±•å¼€çš„å‚æ•°çœ‹èµ·æ¥æ›´åƒæ ‡å‡†çš„yamlé…ç½®ï¼Œæœ‰åç§°/å€¼å¯¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¼šæœ‰ä¸€ä¸ª <code>name</code> keyå’Œä¸€ä¸ª <code>args</code> keyã€‚<code>args</code> keyæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„æ˜ å°„ï¼Œç”¨äºé…ç½®è°“è¯æˆ–è¿‡æ»¤å™¨ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> mycookie
            <span class="token key atrule">regexp</span><span class="token punctuation">:</span> mycookievalue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-afterã€beforeã€between" tabindex="-1"><a class="header-anchor" href="#_1-afterã€beforeã€between"><span>ï¼ˆ1ï¼‰Afterã€Beforeã€Between</span></a></h5><p>ä»¥ä¸‹ä¸‰ä¸ªè¡¨ç¤ºåŒ¹é…åœ¨æŒ‡å®šæ—¥æœŸä¹‹åã€ä¹‹å‰ã€ä¹‹é—´çš„è¯·æ±‚ï¼Œå‡æ˜¯ <code>java ZonedDateTime</code> æ ¼å¼</p><ul><li><code>After</code>ï¼šåœ¨æŒ‡å®šæ—¥æœŸä¹‹å</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
         <span class="token punctuation">-</span> After=2024<span class="token punctuation">-</span>04<span class="token punctuation">-</span>06T10<span class="token punctuation">:</span>15<span class="token punctuation">:</span>38.866925800+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Before</code>:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Before=2024<span class="token punctuation">-</span>04<span class="token punctuation">-</span>06T10<span class="token punctuation">:</span>42<span class="token punctuation">:</span>38.866925800+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>   <span class="token comment"># åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Between</code>:</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>        
                      <span class="token punctuation">-</span> Between=2024<span class="token punctuation">-</span>04<span class="token punctuation">-</span>06T10<span class="token punctuation">:</span>22<span class="token punctuation">:</span>38.866925800+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span>2024<span class="token punctuation">-</span>04<span class="token punctuation">-</span>06T10<span class="token punctuation">:</span>27<span class="token punctuation">:</span>38.866925800+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‹¥ä¸ç¬¦åˆ <code>predicates</code> ï¼š</p><figure><img src="/assets/img/image-20240406102807150.3d0b403e.png" alt="image-20240406102807150" tabindex="0" loading="lazy"><figcaption>image-20240406102807150</figcaption></figure><h5 id="_2-cookieã€headerã€hostã€path" tabindex="-1"><a class="header-anchor" href="#_2-cookieã€headerã€hostã€path"><span>ï¼ˆ2ï¼‰Cookieã€Headerã€HOSTã€PATH</span></a></h5><p><code>Cookie</code>ï¼šåŒ¹é…å…·æœ‰ç»™å®šåç§°ä¸”å…¶å€¼ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„<code>cookie</code></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>        
                       <span class="token punctuation">-</span> Cookie=username<span class="token punctuation">,</span><span class="token number">123</span>  <span class="token comment"># æŒ‡å®šCookie</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Header</code>ï¼šä¸å…·æœ‰ç»™å®šåç§°ä¸”å…¶å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„ <code>header</code> åŒ¹é…</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>        
                  <span class="token comment"># Headerä¸­å¸¦æœ‰X-Request-Idä¸ºæ•´æ•°æ‰å¯è®¿é—®</span>
                       <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>HOST</code>: ä¸€ä¸ªä¸»æœºï¼ˆHostï¼‰åç§°çš„ <code>patterns</code> åˆ—è¡¨ã€‚è¯¥patternæ˜¯Anté£æ ¼çš„æ¨¡å¼ï¼Œä»¥ <code>.</code> ä¸ºåˆ†éš”ç¬¦ã€‚è¿™ä¸ªè°“è¯åŒ¹é…ç¬¦åˆè¯¥patternçš„Host header</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>     
                  <span class="token comment"># å‚æ•°ä¸­å¸¦æœ‰ï¼šä»¥HOSTä¸ºnameï¼Œvalueç¬¦åˆ**.atguigu.com</span>
                      <span class="token punctuation">-</span> Host=<span class="token important">**.atguigu.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><figure><img src="/assets/img/image-20240406110445918.8d9f770d.png" alt="image-20240406110445918" tabindex="0" loading="lazy"><figcaption>image-20240406110445918</figcaption></figure><p><code>PATH</code>: è·¯å¾„åŒ¹é…</p><h5 id="_3-query" tabindex="-1"><a class="header-anchor" href="#_3-query"><span>(3) Query</span></a></h5><p><code>Query</code> è·¯ç”±è°“è¯å·¥å‚éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå¿…éœ€çš„ <code>param</code> å’Œä¸€ä¸ªå¯é€‰çš„ <code>regexp</code>ï¼ˆè¿™æ˜¯ä¸€ä¸ªJavaæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­é…ç½®äº†ä¸€ä¸ª query è·¯ç”±è°“è¯ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>     
                   <span class="token comment"># å‚æ•°ä¸­å¿…é¡»å¸¦æœ‰usernameä¸”å€¼æ˜¯æ•´æ•°</span>
                     <span class="token punctuation">-</span> Query=username<span class="token punctuation">,</span> \d+ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong>ï¼š</p><figure><img src="/assets/img/image-20240406110126338.5e1ff9db.png" alt="image-20240406110126338" tabindex="0" loading="lazy"><figcaption>image-20240406110126338</figcaption></figure><h5 id="_4-remoteaddr" tabindex="-1"><a class="header-anchor" href="#_4-remoteaddr"><span>ï¼ˆ4ï¼‰RemoteAddr</span></a></h5><p><code>RemoteAddr</code> è·¯ç”±è°“è¯å·¥å‚æ¥å—ä¸€ä¸ª <code>sources</code> é›†åˆï¼ˆæœ€å°é•¿åº¦ä¸º1ï¼‰ï¼Œå®ƒæ˜¯CIDRæ³¨è§£ï¼ˆIPv4æˆ–IPv6ï¼‰å­—ç¬¦ä¸²ï¼Œå¦‚ <code>192.168.0.1/16</code>ï¼ˆå…¶ä¸­ <code>192.168.0.1</code> æ˜¯ä¸€ä¸ªIPåœ°å€ï¼Œ<code>16</code> æ˜¯ä¸€ä¸ªå­ç½‘æ©ç ï¼‰</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>     
                  <span class="token comment"># å¤–éƒ¨è®¿é—®æˆ‘çš„IPé™åˆ¶ï¼Œæœ€å¤§è·¨åº¦ä¸è¶…è¿‡32ï¼Œç›®å‰æ˜¯1~24å®ƒä»¬æ˜¯ CIDR è¡¨ç¤ºæ³•ã€‚</span>
                     <span class="token punctuation">-</span> RemoteAddr=192.168.124.1/24 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>CIDR ä½¿ç”¨äº†æ›´çµæ´»çš„æ–¹å¼æ¥è¡¨ç¤º IP åœ°å€å’Œå­ç½‘æ©ç ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å°†å®ƒä»¬åˆ†æˆå‡ ä¸ªå›ºå®šçš„ç±»åˆ«ã€‚CIDR åœ°å€ç”± IP åœ°å€å’Œä¸€ä¸ªåç¼€è¡¨ç¤ºï¼Œåç¼€é€šå¸¸ç”¨æ–œæ ï¼ˆ/ï¼‰åé¢è·Ÿç€ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå­ç½‘æ©ç çš„ä½æ•°ã€‚ä¾‹å¦‚ï¼Œ<code>192.168.1.0/24</code> è¡¨ç¤ºä¸€ä¸ªæ‹¥æœ‰ 24 ä½å­ç½‘æ©ç çš„ç½‘ç»œã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><code>192.168.1.0/30</code></p><p>æœ‰30ä½ç”¨äºç½‘ç»œåœ°å€å’Œå­ç½‘æ©ç ï¼Œå‰©ä¸‹çš„2ä½ç”¨äºä¸»æœºåœ°å€ã€‚æ‰€ä»¥å¯ç”¨çš„ä¸»æœºåœ°å€æ•°æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œå³2^2 = 4</p><p>è¿™å››ä¸ªIPåœ°å€åŒ…æ‹¬ç½‘ç»œåœ°å€ã€å¹¿æ’­åœ°å€å’Œä¸¤ä¸ªå¯ç”¨çš„ä¸»æœºåœ°å€ã€‚ç½‘ç»œåœ°å€å’Œå¹¿æ’­åœ°å€åˆ†åˆ«æ˜¯æ¯ä¸ªå­ç½‘çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªåœ°å€ï¼Œå› æ­¤å¯¹äºCIDRåœ°å€ <code>192.168.1.0/30</code>ï¼š</p><ul><li>ç½‘ç»œåœ°å€æ˜¯ <code>192.168.1.0</code></li><li>ç¬¬ä¸€ä¸ªä¸»æœºåœ°å€æ˜¯ <code>192.168.1.1</code></li><li>ç¬¬äºŒä¸ªä¸»æœºåœ°å€æ˜¯ <code>192.168.1.2</code></li><li>å¹¿æ’­åœ°å€æ˜¯ <code>192.168.1.3</code></li></ul></blockquote><h5 id="_5-methods" tabindex="-1"><a class="header-anchor" href="#_5-methods"><span>ï¼ˆ5ï¼‰Methods</span></a></h5><p><code>Method</code> è·¯ç”±è°“è¯å·¥å‚æ¥å—ä¸€ä¸ª <code>methods</code> å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼šè¦åŒ¹é…çš„HTTPæ–¹æ³•ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>     
                     <span class="token punctuation">-</span> Method=GET<span class="token punctuation">,</span>POST
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-è‡ªå®šä¹‰predicateæ–­è¨€" tabindex="-1"><a class="header-anchor" href="#_6-è‡ªå®šä¹‰predicateæ–­è¨€"><span>ï¼ˆ6ï¼‰è‡ªå®šä¹‰Predicateæ–­è¨€</span></a></h5><blockquote><p>éœ€æ±‚: å¸Œæœ›ç”¨ä¸€ä¸ª userType å­—æ®µæ¥æè¿°ç”¨æˆ·çš„ä¼šå‘˜ç­‰çº§(diamonds, gold, silver)ã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é…ç½®å“ªç§ç­‰çº§çš„ä¼šå‘˜å¯ä»¥è®¿é—®</p></blockquote><p>å…ˆæ¥çœ‹çœ‹ï¼ŒGateWayä¸­åŸæœ‰Predicateæ˜¯æ€ä¹ˆå†™çš„</p><ul><li>åˆ›å»ºä¸€ä¸ª <code>XXXRoutePredicateFactory</code> ç±»ï¼Œæ³¨æ„åç¼€å¿…é¡»æ˜¯ <code>RoutePredicateFactory</code>, å‰é¢æ— æ‰€è°“</li><li>ç»§æ‰¿ <code>AbstractRoutePredicateFactory&lt;Config&gt;</code> æŠ½è±¡ç±»æˆ–è€…å®ç° <code>RoutePredicateFactory&lt;C&gt;</code> æ¥å£</li><li>è‡ªå®šä¹‰çš„ <code>XXXRoutePredicateFactory</code> ç±»ä¸­åŒ…å«4éƒ¨åˆ†ï¼š <ul><li><code>ç©ºå‚æ„é€ å™¨</code>ï¼š è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨</li><li><code>Configé…ç½®ç±»</code> : è¯´æ˜è¦æ ¡éªŒçš„å‚æ•°ï¼Œï¼Œåœ¨æœ¬æ¡ˆä¾‹ä¸­ä¹Ÿå°±æ˜¯ <code>userType</code></li><li><code>applyæ–¹æ³•</code>ï¼š å…·ä½“çš„æ ¡éªŒè¿‡ç¨‹</li><li><code>shortcutFieldOrder</code>: å®ç°å¿«æ·æ–¹å¼ï¼Œè‹¥ä¸å®ç°æ­¤æ–¹æ³•ï¼Œåªèƒ½å¤Ÿä½¿ç”¨<code>å®Œå…¨å±•å¼€</code>çš„é…ç½®æ–¹å¼</li></ul></li></ul><figure><img src="/assets/img/image-20240406114040874.f7fbe0e9.png" alt="image-20240406114040874" tabindex="0" loading="lazy"><figcaption>image-20240406114040874</figcaption></figure><p><strong>ç¤ºä¾‹ä»£ç </strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutePredicateFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRoutePredicateFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 1ã€ç©ºå‚æ„é€ å™¨ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨</span>
    <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//  2ã€é…ç½®ç±»</span>
    <span class="token annotation punctuation">@Validated</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@NotEmpty</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> userType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3ã€å…·ä½“çš„æ ¡éªŒè§„åˆ™</span>
    <span class="token keyword">public</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GatewayPredicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> serverWebExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//  è·å–è¯·æ±‚å‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°</span>
                <span class="token class-name">String</span> userType <span class="token operator">=</span> serverWebExchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;userType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//  è‹¥ä¸ºnullè¿”å›false</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>userType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token comment">// è¯·æ±‚å‚æ•°ä¸­çš„userTYpeä¸é…ç½®çš„userTypeç›¸ç­‰ï¼Œåˆ™è¿”å›true</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>userType<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getUserType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//  4ã€å¿«æ·æ–¹å¼</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;userType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ï¼Œå°†ç½‘å…³æ¨¡å—é‡æ–°å¯åŠ¨ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹è§è‡ªå®šä¹‰çš„æ–­è¨€å·¥å‚ï¼š</p><figure><img src="/assets/img/image-20240406120715377.559f60de.png" alt="image-20240406120715377" tabindex="0" loading="lazy"><figcaption>image-20240406120715377</figcaption></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥é…ç½®ä½¿ç”¨äº†ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>     
                     <span class="token punctuation">-</span> My=diamonds <span class="token comment"># è‡ªå®šä¹‰çš„æ–­è¨€ï¼Œè¯·æ±‚å‚æ•°ä¸­çš„userType=diamonds</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-2-filterè¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_6-3-2-filterè¿‡æ»¤å™¨"><span>6.3.2 Filterè¿‡æ»¤å™¨</span></a></h4><p>å’Œ SpringMVC ä¸­çš„æ‹¦æˆªå™¨ï¼ŒServletä¸­çš„è¿‡æ»¤å™¨ä¸€ä¸ªæ„æ€</p><p><strong>èƒ½å¹²å˜›</strong>ï¼š</p><ul><li>è¯·æ±‚é‰´æƒ</li><li>å¼‚å¸¸å¤„ç†</li><li><strong>è®°å½•æ¥å£è°ƒç”¨æ—¶é•¿ç»Ÿè®¡</strong></li></ul><p><strong>ç±»å‹</strong></p><ul><li><code>GatewayFilter </code>ï¼šå…¨å±€è¿‡æ»¤å™¨</li><li><code>GlobalFilter</code>ï¼š å•ä¸€å†…ç½®çš„è¿‡æ»¤å™¨</li><li><code>è‡ªå®šä¹‰è¿‡æ»¤å™¨</code></li></ul><h5 id="_1-è¯·æ±‚å¤´ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#_1-è¯·æ±‚å¤´ç›¸å…³"><span>ï¼ˆ1ï¼‰è¯·æ±‚å¤´ç›¸å…³</span></a></h5><p><code>AddRequestHeader</code> : éœ€è¦ä¸€ä¸ª <code>name</code> å’Œ <code>value</code> å‚æ•°ï¼Œå¢åŠ åˆ°è¯·æ±‚å¤´ä¸­</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>             
                  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
                  <span class="token comment"># è¯·æ±‚å¤´kvï¼Œè‹¥ä¸€å¤´å«æœ‰å¤šå‚åˆ™é‡å†™ä¸€è¡Œè®¾ç½®</span>
                      <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu1<span class="token punctuation">,</span>atguiguValue1  
                      <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>atguigu2<span class="token punctuation">,</span>atguiguValue2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>RemoveRequestHeader</code>:éœ€è¦ä¸€ä¸ª <code>name</code> å‚æ•°ã€‚å®ƒæ˜¯è¦è¢«åˆ é™¤çš„headerçš„åç§°</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>             
                  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span>  RemoveRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>site      <span class="token comment"># åˆ é™¤è¯·æ±‚å¤´sec-fetch-site</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>SetRequestHeader</code>:æ¥å— <code>name</code> å’Œ <code>value</code> å‚æ•°, æ ¹æ®nameä¿®æ”¹æˆä¸º value</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>             
                  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span>  SetRequestHeader=sec<span class="token punctuation">-</span>fetch<span class="token punctuation">-</span>mode<span class="token punctuation">,</span> Blue<span class="token punctuation">-</span>updatebyzzyy <span class="token comment"># å°†è¯·æ±‚å¤´sec-fetch-modeå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBlue-updatebyzzyy</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-è¯·æ±‚å‚æ•°ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#_2-è¯·æ±‚å‚æ•°ç›¸å…³"><span>ï¼ˆ2ï¼‰è¯·æ±‚å‚æ•°ç›¸å…³</span></a></h5><p><code>AddRequestParameter</code> : éœ€è¦ä¸€ä¸ª <code>name</code> å’Œ <code>value</code> å‚æ•°, å¢åŠ è¯·æ±‚å‚æ•°</p><p><code>RemoveRequestParameter</code> ï¼š éœ€è¦ä¸€ä¸ª <code>name</code> å‚æ•°ã€‚å®ƒæ˜¯è¦åˆ é™¤çš„æŸ¥è¯¢å‚æ•°çš„åç§°</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span> 
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pay_routh1 
                  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service            
                  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
                      <span class="token punctuation">-</span> Path=/pay/gateway/filter/<span class="token important">**</span>             
                  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
                  <span class="token comment"># æ–°å¢è¯·æ±‚å‚æ•°Parameterï¼šk ï¼Œv</span>
                    <span class="token punctuation">-</span> AddRequestParameter=customerId<span class="token punctuation">,</span><span class="token number">9527001</span> 
                    <span class="token comment"># åˆ é™¤urlè¯·æ±‚å‚æ•°customerNameï¼Œä½ ä¼ é€’è¿‡æ¥ä¹Ÿæ˜¯null</span>
                    <span class="token punctuation">-</span> RemoveRequestParameter=customerName   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-å›åº”å¤´ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#_3-å›åº”å¤´ç›¸å…³"><span>ï¼ˆ3ï¼‰å›åº”å¤´ç›¸å…³</span></a></h5><p><code>AddResponseHeader</code> : éœ€è¦ä¸€ä¸ª <code>name</code> å’Œ <code>value</code>å¢åŠ å›åº”å¤´ï¼Œ</p><p><code>RemoveResponseHeader</code>éœ€è¦ä¸€ä¸ª <code>name</code> å‚æ•°ã€‚å®ƒæ˜¯è¦è¢«ç§»é™¤çš„ header çš„åç§°</p><p><code>SetResponseHeader</code> æ¥å— <code>name</code> å’Œ <code>value</code> å‚æ•° ,ä¿®æ”¹åç§°ä¸º <code>name</code> çš„å›åº”å¤´</p><h5 id="_4-å‰ç¼€å’Œè·¯å¾„ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#_4-å‰ç¼€å’Œè·¯å¾„ç›¸å…³"><span>ï¼ˆ4ï¼‰å‰ç¼€å’Œè·¯å¾„ç›¸å…³</span></a></h5><p><code>PrefixPath</code> : è‡ªåŠ¨æ·»åŠ è·¯å¾„å‰ç¼€, ä¸‹é¢è¿™ä¸ªä¾‹å­æŠŠ <code>/mypath</code> ä½œä¸ºæ‰€æœ‰åŒ¹é…è¯·æ±‚çš„è·¯å¾„çš„å‰ç¼€</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span>  pay_routh1 
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service    
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> PrefixPath=/mypath
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>SetPathï¼š</code>ä¿®æ”¹è·¯å¾„ï¼Œæ¥å—ä¸€ä¸ªè·¯å¾„æ¨¡æ¿å‚æ•°ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œé€šè¿‡å…è®¸æ¨¡æ¿åŒ–çš„è·¯å¾„æ®µæ¥æ“ä½œè¯·æ±‚è·¯å¾„</p><p>å¯¹äºè¯·æ±‚è·¯å¾„ä¸º <code>/red/blue</code> çš„æƒ…å†µï¼Œåœ¨è¿›è¡Œä¸‹è¡Œè¯·æ±‚ä¹‹å‰ï¼Œå°†è·¯å¾„è®¾ç½®ä¸º <code>/blue</code>ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/red/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetPath=/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>RedirectTo </code>éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œ<code>status</code> å’Œ <code>url</code>ã€‚<code>status</code> å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ª300ç³»åˆ—çš„é‡å®šå‘ HTTP çŠ¶æ€ç ï¼Œå¦‚301ã€‚<code>url</code> å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„URL</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
         <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//www.atguigu.com/ 
         <span class="token comment"># è®¿é—®http://localhost:9527/pay/gateway/filterè·³è½¬åˆ°http://www.atguigu.com/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_5-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"><span>ï¼ˆ5ï¼‰è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</span></a></h5><blockquote><p><strong>éœ€æ±‚</strong>ï¼šç»Ÿè®¡æ‰€æœ‰æ¥å£è°ƒç”¨è€—æ—¶</p><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEGIN_VISIT_TIME</span> <span class="token operator">=</span> <span class="token string">&quot;begin_visit_time&quot;</span><span class="token punctuation">;</span><span class="token comment">//å¼€å§‹è®¿é—®æ—¶é—´</span>
    <span class="token doc-comment comment">/**
     *ç¬¬2ç‰ˆï¼Œå„ç§ç»Ÿè®¡
     * <span class="token keyword">@param</span> <span class="token parameter">exchange</span>
     * <span class="token keyword">@param</span> <span class="token parameter">chain</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å…ˆè®°å½•ä¸‹è®¿é—®æ¥å£çš„å¼€å§‹æ—¶é—´</span>
        exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token constant">BEGIN_VISIT_TIME</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">Long</span> beginVisitTime <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">BEGIN_VISIT_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beginVisitTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®æ¥å£ä¸»æœº: &quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®æ¥å£ç«¯å£: &quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®æ¥å£URL: &quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®æ¥å£URLå‚æ•°: &quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRawQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®æ¥å£æ—¶é•¿: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginVisitTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘æ˜¯ç¾ä¸½åˆ†å‰²çº¿: ###################################################&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-è‡ªå®šä¹‰å•ä¸€å†…ç½®è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#_6-è‡ªå®šä¹‰å•ä¸€å†…ç½®è¿‡æ»¤å™¨"><span>ï¼ˆ6ï¼‰è‡ªå®šä¹‰å•ä¸€å†…ç½®è¿‡æ»¤å™¨</span></a></h5><blockquote><p>ä¸Šé¢æ˜¯å…¨å±€è¿‡æ»¤å™¨ï¼Œåªè¦å‘é€è¯·æ±‚å°±ä¼šæ‰§è¡Œ</p><p>ä¸‹é¢å®šä¹‰å•ä¸€å†…ç½®è¿‡æ»¤å™¨</p></blockquote><p>å…ˆçœ‹çœ‹GateWayåŸå‚çš„è¿‡æ»¤å™¨å¦‚ä½•å®ç°ï¼š</p><blockquote><p>çœ‹æºç å…¶å®èƒ½çœ‹å‡ºæ¥ï¼Œå’Œè‡ªå®šä¹‰Predicateéå¸¸ç›¸ä¼¼ã€‚</p></blockquote><ul><li>åˆ›å»º <code>XXXGatewayFilterFactory</code>, åç¼€å¿…é¡»æ˜¯ <code>GatewayFilterFactory</code>, å‰é¢æ— æ‰€è°“</li><li>ç»§æ‰¿ <code>AbstractGatewayFilterFactory&lt;Config&gt;</code> æŠ½è±¡ç±»æˆ–è€…å®ç° <code>GatewayFilterFactory&lt;C&gt;</code> æ¥å£</li><li>è‡ªå®šä¹‰çš„ <code>XXXGatewayFilterFactory</code> ç±»ä¸­åŒ…å«4éƒ¨åˆ†ï¼š <ul><li><code>ç©ºå‚æ„é€ å™¨</code>ï¼š è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨</li><li><code>Configé…ç½®ç±»</code> : è¯´æ˜è¦æ ¡éªŒçš„å‚æ•°</li><li><code>applyæ–¹æ³•</code>ï¼š å…·ä½“çš„æ ¡éªŒè¿‡ç¨‹</li><li><code>shortcutFieldOrder</code>: å®ç°å¿«æ·æ–¹å¼ï¼Œè‹¥ä¸å®ç°æ­¤æ–¹æ³•ï¼Œåªèƒ½å¤Ÿä½¿ç”¨<code>å®Œå…¨å±•å¼€</code>çš„é…ç½®æ–¹å¼</li></ul></li></ul><figure><img src="/assets/img/image-20240406170813435.a62d7f33.png" alt="image-20240406170813435" tabindex="0" loading="lazy"><figcaption>image-20240406170813435</figcaption></figure><p><strong>ä»£ç </strong></p><blockquote><p>åˆ¤æ–­è¯·æ±‚å‚æ•°ä¸­æ˜¯å¦åŒ…å«ï¼š<code>atguigu</code> , ä¸åŒ…å«ç›´æ¥è¿”å›<code>400</code></p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Config</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MyGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">MyGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">MyGatewayFilterFactory<span class="token punctuation">.</span>Config</span> config<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GatewayFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿›å…¥äº†è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨MyGatewayFilterFactoryï¼Œstatusï¼š&quot;</span><span class="token operator">+</span>config<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">BAD_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span>
    <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Getter</span>
        <span class="token annotation punctuation">@Setter</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span><span class="token comment">//è®¾å®šä¸€ä¸ªçŠ¶æ€å€¼/æ ‡å¿—ä½ï¼Œå®ƒç­‰äºå¤šå°‘ï¼ŒåŒ¹é…å’Œæ‰å¯ä»¥è®¿é—®</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//å•ä¸€å†…ç½®è¿‡æ»¤å™¨GatewayFilter</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é…ç½®</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>spring:
  cloud:
    gateway:
      routes:
      - id: prefixpath_route
        uri: https://example.org
        filters:
          - My=atguigu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: â€œyangzhaoguang@ciictec.comâ€">â€œæ¨ç…§å…‰â€</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link nav-link next" href="/Microservices/SpringCloud%20Alibaba.html" aria-label="SpringCloud Alibaba"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">SpringCloud Alibaba<!----></div></a></nav><div id="vp-comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v3.1.3</div></div></div><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.c5243060.js" defer></script><script src="/assets/js/549.dd93fff4.js" defer></script><script src="/assets/js/app.37257e1e.js" defer></script>
  </body>
</html>
