"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[7390],{66262:(s,a)=>{a.A=(s,a)=>{const n=s.__vccOpts||s;for(const[s,e]of a)n[s]=e;return n}},66671:(s,a,n)=>{n.r(a),n.d(a,{comp:()=>D,data:()=>C});var e=n(20641);const o=n.p+"assets/img/image-20240309204147339.f562c8b9.png",p=n.p+"assets/img/image-20240309204157480.7ffc3256.png",t=n.p+"assets/img/image-20240309204229520.4ae17306.png",l=n.p+"assets/img/image-20240309204534652.704eefbc.png",i=n.p+"assets/img/image-20240309212058249.9ab37a53.png",c=n.p+"assets/img/image-20240310083958313.8734f519.png",r=n.p+"assets/img/image-20240310090045821.016306c9.png",d=n.p+"assets/img/image-20240310090133802.4e650a5f.png",k=n.p+"assets/img/image-20240310090245790.5b5aed3c.png",u=n.p+"assets/img/image-20240310090328759.e8d6db0c.png",g=n.p+"assets/img/image-20240310090400721.a51a0b61.png",m=n.p+"assets/img/image-20240310090854664.99a887f2.png",v=n.p+"assets/img/image-20240310091146963.ef4dec53.png",y=n.p+"assets/img/image-20240310091215725.e5cd9195.png",b=n.p+"assets/img/image-20240310091400898.5402965e.png",E=n.p+"assets/img/image-20240310091643267.a2531d83.png",f=n.p+"assets/img/image-20240310091731883.e7aec824.png",w=n.p+"assets/img/image-20240310091919576.fb8123da.png",L=n.p+"assets/img/image-20240310092030111.d59f0fed.png",h=n.p+"assets/img/image-20240310092129260.46031f50.png",q=n.p+"assets/img/image-20240310092716677.c431a445.png",I=n.p+"assets/img/image-20240310092957534.89d7c8ea.png",R=n.p+"assets/img/image-20240310094837880.2733179b.png",N=n.p+"assets/img/image-20240310095023881.3c16f45a.png",S=n.p+"assets/img/image-20240310095108269.1329a219.png",A=n.p+"assets/img/image-20240310102153604.dd1eb76a.png",x=n.p+"assets/img/image-20240310095346237.4adee068.png",M=n.p+"assets/img/image-20240310095527031.71d104b0.png",O=n.p+"assets/img/image-20240310095627040.c28bca79.png",P=n.p+"assets/img/image-20240310095915180.929dd89c.png",T=n.p+"assets/img/image-20240310100526181.ffea62a2.png",U=n.p+"assets/img/image-20240310100628691.566887c3.png",X=n.p+"assets/img/image-20240310100857719.c0f93d7c.png",F=[(0,e.Fv)('<h1 id="十二、性能分析工具的使用" tabindex="-1"><a class="header-anchor" href="#十二、性能分析工具的使用"><span>十二、性能分析工具的使用</span></a></h1><h2 id="_12-1-数据库服务器的优化步骤" tabindex="-1"><a class="header-anchor" href="#_12-1-数据库服务器的优化步骤"><span>12.1 数据库服务器的优化步骤</span></a></h2><p>当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。</p><p>整个流程划分成了 <code>观察（Show status）</code> 和 <code>行动（Action）</code> 两个部分。字母 S 的部分代表观察（会使 用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。</p><figure><img src="'+o+'" alt="image-20240309204147339" tabindex="0" loading="lazy"><figcaption>image-20240309204147339</figcaption></figure><figure><img src="'+p+'" alt="image-20240309204157480" tabindex="0" loading="lazy"><figcaption>image-20240309204157480</figcaption></figure><figure><img src="'+t+'" alt="image-20240309204229520" tabindex="0" loading="lazy"><figcaption>image-20240309204229520</figcaption></figure><h2 id="_12-2-查看系统性能参数" tabindex="-1"><a class="header-anchor" href="#_12-2-查看系统性能参数"><span>12.2 查看系统性能参数</span></a></h2><p>在MySQL中，可以使用<code>SHOW STATUS</code>语句查询一些MySQL数据库服务器的 性能参数、 SHOW STATUS语句语法如下</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">]</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">&#39;参数&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>性能参数如下</strong>：</p><figure><img src="'+l+'" alt="image-20240309204534652" tabindex="0" loading="lazy"><figcaption>image-20240309204534652</figcaption></figure><h2 id="_12-3-统计sql的查询成本-last-query-cost" tabindex="-1"><a class="header-anchor" href="#_12-3-统计sql的查询成本-last-query-cost"><span>12.3 统计SQL的查询成本：last_query_cost</span></a></h2><p>如果我们想要查询 id=900001 的记录，然后看下查询成本，我们可以直接在聚簇索引上进行查找：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info \n<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">900001</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果（1 条记录，运行时间为 0.042s ）</p><p>然后再看下查询优化器的成本，实际上我们只需要检索一个页即可：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">&#39;last_query_cost&#39;</span><span class="token punctuation">;</span>\n <span class="token operator">+</span><span class="token comment">-----------------+----------+</span>\n <span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>    \n<span class="token operator">|</span>\n <span class="token operator">+</span><span class="token comment">-----------------+----------+</span>\n <span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">1.000000</span> <span class="token operator">|</span>\n <span class="token operator">+</span><span class="token comment">-----------------+----------+</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果我们想要查询 id 在 900001 到 9000100 之间的学生记录呢？</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> student_id<span class="token punctuation">,</span> class_id<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> create_time <span class="token keyword">FROM</span> student_info \n<span class="token keyword">WHERE</span> id <span class="token operator">BETWEEN</span> <span class="token number">900001</span> <span class="token operator">AND</span> <span class="token number">900100</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果（100 条记录，运行时间为 0.046s ）： 然后再看下查询优化器的成本，这时我们大概需要进行 20 个页的查询。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">&#39;last_query_cost&#39;</span><span class="token punctuation">;</span>\n <span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>\n <span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     \n<span class="token operator">|</span>\n <span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>\n <span class="token operator">|</span> Last_query_cost <span class="token operator">|</span> <span class="token number">21.134453</span> <span class="token operator">|</span>\n <span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你能看到页的数量是刚才的 20 倍，但是查询的效率并没有明显的变化，实际上这两个 SQL 查询的时间 基本上一样，就是因为采用了<code>顺序读取的方式</code>将页面一次性加载到缓冲池中，然后再进行查找。虽然 数量（last_query_cost）增加了不少 ，但是通过缓冲池的机制，并 没有增加多少查询时间。</p><p><strong>使用场景</strong>：它对于比较开销是非常有用的，特别是我们有好几种查询方式可选的时候。</p><h2 id="_12-4-定位执行慢的sql-慢查询日志" tabindex="-1"><a class="header-anchor" href="#_12-4-定位执行慢的sql-慢查询日志"><span>12.4 定位执行慢的SQL：慢查询日志</span></a></h2><p>MySQL的慢查询日志，用来记录在MySQL中 <code>响应时间超过阀值</code> 的语句，具体指运行时间超过long_query_time 值的SQL，则会被记录到慢査询日志中。 long_query_time的默认值为<code>10</code>，意思是运行10秒以上(不含10秒)的语句，认为是超出了我们的最大忍耐时间值。</p><p>默认情况下，MySQL数据库 <code>没有开启慢查询日志</code>，需要我们手动来设置这个参数。<strong>如果不是调优需要的话，一般不建议启动该参数，因为开启慢查询日志会或多或少带来一定的性能影响</strong>。</p><h3 id="_12-4-1-开启-关闭-删除-慢查询日志" tabindex="-1"><a class="header-anchor" href="#_12-4-1-开启-关闭-删除-慢查询日志"><span>12.4.1 开启/关闭/删除 慢查询日志</span></a></h3><p>查看慢查询日志是否开启</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%slow_query_log%&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>开启慢查询日志</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log<span class="token operator">=</span><span class="token string">&#39;ON&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看慢查询的时间阈值设置，使用如下命令：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%long_query_time%&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>设置慢查询时间阈值</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token punctuation">[</span><span class="token keyword">global</span><span class="token punctuation">]</span> long_query_time <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  \n<span class="token comment"># 不加global只是当前窗口有效</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>关闭慢查询日志：</strong></p><p><strong>永久关闭</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>\n slow_query_log<span class="token operator">=</span><span class="token keyword">OFF</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>或者删掉slow_query_log=OFF</p><p><strong>临时性方式</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> slow_query_log<span class="token operator">=</span><span class="token keyword">off</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>删除慢查询日志</strong></p><figure><img src="data:image/png;base64,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" alt="image-20240309213148974" tabindex="0" loading="lazy"><figcaption>image-20240309213148974</figcaption></figure><p>手动删除后，使用命令 <code>mysqladmin flush-1ogs</code> 来重新生成查询日志文件，具体命令如下，执行完毕会在数据目录下重新生成慢查询日志文件。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysqladmin <span class="token operator">-</span>uroot <span class="token operator">-</span>p flush<span class="token operator">-</span>logs slow\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_12-4-2-慢查询日志分析工具-mysqldumpslow" tabindex="-1"><a class="header-anchor" href="#_12-4-2-慢查询日志分析工具-mysqldumpslow"><span>12.4.2 慢查询日志分析工具：mysqldumpslow</span></a></h3><p>在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具 <code>mysqldumpslow </code></p><p>查看mysqldumpslow帮助信息：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysqldumpslow <span class="token comment">--help</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+i+'" alt="image-20240309212058249" tabindex="0" loading="lazy"><figcaption>image-20240309212058249</figcaption></figure><ul><li>-a: 不将数字抽象成N，字符串抽象成S</li><li>-s: 是表示按照何种方式排序： <ul><li>c: 访问次数</li><li>l: 锁定时间</li><li>r: 返回记录</li><li><strong>t: 查询时间</strong></li><li>al:平均锁定时间</li><li>ar:平均返回记录数</li><li>at:平均查询时间 （默认方式）</li><li>ac:平均查询次数</li></ul></li><li>-t: 即为返回前面多少条的数据；</li><li>-g: 后边搭配一个正则匹配模式，大小写不敏感的；</li></ul><p><strong>工作中常用的</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">#得到查询时间最多的10个SQL</span>\n mysqldumpslow <span class="token operator">-</span>s t <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log\n<span class="token comment">#得到返回记录集最多的10个SQL</span>\n mysqldumpslow <span class="token operator">-</span>s r <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log\n <span class="token comment">#得到访问次数最多的10个SQL</span>\n mysqldumpslow <span class="token operator">-</span>s c <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log\n <span class="token comment">#得到按照时间排序的前10条里面含有左连接的查询语句</span>\nmysqldumpslow <span class="token operator">-</span>s t <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">-</span>g <span class="token string">&quot;left join&quot;</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log\n <span class="token comment">#另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现爆屏情况</span>\nmysqldumpslow <span class="token operator">-</span>s r <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token operator">|</span> more\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-5-分析查询语句" tabindex="-1"><a class="header-anchor" href="#_12-5-分析查询语句"><span><strong>12.5 分析查询语句</strong></span></a></h2><p>定位了查询慢的 SQL 之后，我们就可以使用 <code>EXPLAIN </code>或 <code>DESCRIBE</code> 工具做针对性的分析查询语句。 。<strong>DESCRIBE</strong> 语句的使用方法与EXPLAIN语句是一样的，并且分析结果也是一样的。</p><p><strong>能做什么？</strong></p><ul><li><p>表的读取顺序</p></li><li><p>数据读取操作的操作类型</p></li><li><p>哪些索引可以使用</p></li><li><p><strong>哪些索引被实际使用</strong></p></li><li><p>表之间的引用</p></li><li><p><strong>每张表有多少行被优化器查询</strong></p></li></ul><p><strong>基本语法</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> select_options\n或者\n<span class="token keyword">DESCRIBE</span> <span class="token keyword">SELECT</span> select_options\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>EXPLAIN </code>语句输出的各个列的作用如下</p><figure><img src="'+c+'" alt="image-20240310083958313" tabindex="0" loading="lazy"><figcaption>image-20240310083958313</figcaption></figure><h3 id="_12-5-1-table" tabindex="-1"><a class="header-anchor" href="#_12-5-1-table"><span>12.5.1 table</span></a></h3><p>不论我们的查询语句有多复杂，里边儿 <code>包含了多少个表</code>，到最后也是需要对每个表进行 单表访问的，<strong>所 以MySQL规定EXPLAIN语句输出的每条记录都对应着某个单表的访问方法</strong>，该条记录的table列代表着该 表的表名（有时不是真实的表名字，可能是简称）。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2<span class="token punctuation">;</span>\n<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------------+</span>\n<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                         <span class="token operator">|</span>\n<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------------+</span>\n<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> s1    <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">9895</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>                          <span class="token operator">|</span>\n<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> s2    <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">9895</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span><span class="token keyword">hash</span> <span class="token keyword">join</span><span class="token punctuation">)</span> <span class="token operator">|</span>\n<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------------+</span>\n<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-5-2-id" tabindex="-1"><a class="header-anchor" href="#_12-5-2-id"><span>12.5.2 id</span></a></h3><p>查询语句中每出现一个 SELECT 关键字，MYSQL 就会为它分配一个唯一的ID</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+r+'" alt="image-20240310090045821" tabindex="0" loading="lazy"><figcaption>image-20240310090045821</figcaption></figure><p>当涉及多个SELECT时，id值为多个</p><figure><img src="'+d+'" alt="image-20240310090133802" tabindex="0" loading="lazy"><figcaption>image-20240310090133802</figcaption></figure><p>需要注意的是，并不是有多少个SELECT就会有多少ID，因此查询优化器可能对涉及子查询的查询语句进行重写,转变为多表查询的操作</p><figure><img src="'+k+'" alt="image-20240310090245790" tabindex="0" loading="lazy"><figcaption>image-20240310090245790</figcaption></figure><p>在使用 UNION 表进行去重的时候，可能会涉及到临时表</p><figure><img src="'+u+'" alt="image-20240310090328759" tabindex="0" loading="lazy"><figcaption>image-20240310090328759</figcaption></figure><p>使用 UNION ALL 就无需使用临时表</p><figure><img src="'+g+'" alt="image-20240310090400721" tabindex="0" loading="lazy"><figcaption>image-20240310090400721</figcaption></figure><p><strong>总结</strong></p><ul><li><p>id值相同，可以认为是一组</p></li><li><p>id值越大，优先级越高，越先执行</p></li><li><p>关注点：id号每个号码，表示一趟独立的查询，一个sql查询的趟数越少越好</p></li></ul><h3 id="_12-5-3-select-type" tabindex="-1"><a class="header-anchor" href="#_12-5-3-select-type"><span>12.5.3 select_type</span></a></h3><p>一条大的查询语句里边可以包含<code>若干个SELECT关键字</code>，每个SELECT关键字代表着一个小的査询语句，而每个SELECT关键字的FROM子句中都可以包含若干张表(这些表用来做连接査询)，<code>每一张表都对应着执行计划输出中的一条记录 </code>，对于在同一个SELECT关键字中的表来说，它们的id值是相同的。</p><p>MySQL<code>为每一个SELECT关键字代表的小査询都定义了一个称之为 select_type 的属性</code>，意思是我们只要知道了某个小査询的 select_type属性，就知道了这个 小査询在整个大査询中扮演了一个什么角色，我们看一下select_type都能取哪些值，请看官方文档:</p><figure><img src="'+m+'" alt="image-20240310090854664" tabindex="0" loading="lazy"><figcaption>image-20240310090854664</figcaption></figure><p>查询语句中不包含<code>UNION</code>或者子查询的查询都算作是<code>SIMPLE</code>类型</p><figure><img src="'+v+'" alt="image-20240310091146963" tabindex="0" loading="lazy"><figcaption>image-20240310091146963</figcaption></figure><p>连接查询也算是<code>SIMPLE</code>类型</p><figure><img src="'+y+'" alt="image-20240310091215725" tabindex="0" loading="lazy"><figcaption>image-20240310091215725</figcaption></figure><p>对于包含<code>UNION</code>或者<code>UNION ALL</code>或者子查询的大查询来说，它是由几个小查询组成的，其中最左边的那个查询的<code>select_type</code>值就是<code>PRIMARY</code></p><p>对于包含<code>UNION</code>或者<code>UNION ALL</code>的大查询来说，它是由几个小查询组成的，其中除了最左边的那个小查询以外，其余的小查询的<code>select_type</code>值就是<code>UNION</code></p><p>其中 UNION RESULT 就是临时表！</p><figure><img src="'+b+'" alt="image-20240310091400898" tabindex="0" loading="lazy"><figcaption>image-20240310091400898</figcaption></figure><p>如果包含子查询的查询语句不能够转为对应的<code>semi-join</code>的形式，并且该子查询是不相关子查询。该子查询的第一个<code>SELECT</code>关键字代表的那个查询的<code>select_type</code>就是<code>SUBQUERY</code></p><figure><img src="'+E+'" alt="image-20240310091643267" tabindex="0" loading="lazy"><figcaption>image-20240310091643267</figcaption></figure><p>如果包含子查询的查询语句不能够转为对应的<code>semi-join</code>的形式，并且该子查询是相关子查询，则该子查询的第一个<code>SELECT</code>关键字代表的那个查询的<code>select_type</code>就是<code>DEPENDENT SUBQUERY</code></p><figure><img src="'+f+'" alt="image-20240310091731883" tabindex="0" loading="lazy"><figcaption>image-20240310091731883</figcaption></figure><p>注意的是，select_type为<code>DEPENDENT SUBQUERY</code>的查询可能会被执行多次。</p><p>在包含<code>UNION</code>或者<code>UNION ALL</code>的大查询中，如果各个小查询都依赖于外层查询的话，那除了最左边的那个小查询之外，其余的小查询的<code>select_type</code>的值就是<code>DEPENDENT UNION</code>。</p><figure><img src="'+w+'" alt="image-20240310091919576" tabindex="0" loading="lazy"><figcaption>image-20240310091919576</figcaption></figure><p>对于包含<code>派生表</code>的查询，该派生表对应的子查询的<code>select_type</code>就是<code>DERIVED</code></p><figure><img src="'+L+'" alt="image-20240310092030111" tabindex="0" loading="lazy"><figcaption>image-20240310092030111</figcaption></figure><p>#当查询优化器在执行包含子查询的语句时，选择将子查询物化之后与外层查询进行连接查询时，该子查询对应的<code>select_type</code>属性就是<code>MATERIALIZED</code></p><figure><img src="'+h+'" alt="image-20240310092129260" tabindex="0" loading="lazy"><figcaption>image-20240310092129260</figcaption></figure><h3 id="_12-5-4-type△" tabindex="-1"><a class="header-anchor" href="#_12-5-4-type△"><span>12.5.4 type△</span></a></h3><p>执行计划的一条记录就代表着MySQL对某个表的 <code>执行査询时的访问方法，又称“访问类型</code>”，其中的 type 列就表明了这个访问方法是啥，是较为重要的一个指标。比如，看到type列的值是ref，表明MySQL 即将使用 ref访问方法来执行对 s1 表的查询。</p><p>完整的访问方法如下: <code>system ， const ， eq_ref ， ref ， index_merge ， unique_subquery ， fulltext ， ref_or_null ， index_subquery ,range,index,ALL</code></p><p><strong>system</strong></p><p>当表中 <code>只有一条记录 </code>并且该表使用的存储引擎的统计数据是精确的，比如MyISAM、Memory，那么对该表的访 问方法就是 system 。比方说我们新建一个 MyISAM 表，并为其插入1条记录</p><p><strong>例如</strong>：MyISAM表中只有一条记录，执行 count(*) 时type就是system</p><p>MyISAM中维护一个计数器，记录表中的总记录数，使用 count(*) 直接返回</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t<span class="token punctuation">(</span>i <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MYISAM<span class="token punctuation">;</span>\n <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n \n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="'+q+'" alt="image-20240310092716677" tabindex="0" loading="lazy"><figcaption>image-20240310092716677</figcaption></figure><p><strong>cost</strong></p><p>当我们根据主键或者唯一二级索引列与常数进行等值匹配时，对单表的访问方法就是 <code>const</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">;</span>\n \n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key2 <span class="token operator">=</span> <span class="token number">10066</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="'+I+'" alt="image-20240310092957534" tabindex="0" loading="lazy"><figcaption>image-20240310092957534</figcaption></figure><p><strong>eq_ref</strong></p><p>在连接查询时，如果被驱动表是通过主键或者唯一二级索引列等值匹配的方式进行访问的,（如果该主键或者唯一二级索引是联合索引的话，所有的索引列都必须进行等值比较），则对该被驱动表的访问方法就是<code>eq_ref</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> s2<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+R+'" alt="image-20240310094837880" tabindex="0" loading="lazy"><figcaption>image-20240310094837880</figcaption></figure><p><strong>ref</strong></p><p>当通过普通的二级索引列与常量进行等值匹配时来查询某个表，那么对该表的访问方法就可能是<code>ref</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+N+'" alt="image-20240310095023881" tabindex="0" loading="lazy"><figcaption>image-20240310095023881</figcaption></figure><p><strong>ref_or_null</strong></p><p>当对普通二级索引进行等值匹配查询，该索引列的值也可以是<code>NULL</code>值时，那么对该表的访问方法就可能是<code>ref_or_null</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">OR</span> key1 <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+S+'" alt="image-20240310095108269" tabindex="0" loading="lazy"><figcaption>image-20240310095108269</figcaption></figure><p><strong>index_merge</strong></p><p>单表访问方法时在某些场景下可以使用<code>Intersection</code>、<code>Union、Sort-Union</code>这三种索引合并的方式来执行查询</p><figure><img src="'+A+'" alt="image-20240310102153604" tabindex="0" loading="lazy"><figcaption>image-20240310102153604</figcaption></figure><p><strong>unique_subquery</strong></p><p><code>unique_subquery</code>是针对在一些包含<code>IN</code>子查询的查询语句中，如果查询优化器决定将<code>IN</code>子查询 #转换为<code>EXISTS</code>子查询，而且子查询可以使用到主键进行等值匹配的话，那么该子查询执行计划的<code>type</code> #列的值就是<code>unique_subquery</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 \n <span class="token keyword">WHERE</span> key2 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> s2 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1<span class="token punctuation">)</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="'+x+'" alt="image-20240310095346237" tabindex="0" loading="lazy"><figcaption>image-20240310095346237</figcaption></figure><p><strong>range</strong></p><p>如果使用索引获取某些<code>范围区间</code>的记录，那么就可能使用到<code>range</code>访问方法</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+M+'" alt="image-20240310095527031" tabindex="0" loading="lazy"><figcaption>image-20240310095527031</figcaption></figure><p><strong>index</strong></p><p>当我们可以使用索引覆盖，但需要扫描全部的索引记录时，该表的访问方法就是<code>index</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key_part2 <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key_part3 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+O+'" alt="image-20240310095627040" tabindex="0" loading="lazy"><figcaption>image-20240310095627040</figcaption></figure><p><strong>all</strong></p><p>全表扫描</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>结果值从最好到最坏依次是： <code>system &gt; const &gt; eq_ref &gt; ref</code> &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; <code>range &gt; index &gt; ALL </code></p><h3 id="_12-5-5-possible-keys和key" tabindex="-1"><a class="header-anchor" href="#_12-5-5-possible-keys和key"><span><strong>12.5.5 possible_keys和key</strong></span></a></h3><p>可能用到的索引 和 实际上使用的索引</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">&#39;z&#39;</span> <span class="token operator">AND</span> key3 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+P+'" alt="image-20240310095915180" tabindex="0" loading="lazy"><figcaption>image-20240310095915180</figcaption></figure><h3 id="_12-5-6-key-len-☆" tabindex="-1"><a class="header-anchor" href="#_12-5-6-key-len-☆"><span>12.5.6 key_len ☆</span></a></h3><p>实际使用到的索引长度(即：字节数)</p><p>帮你检查<code>是否充分的利用上了索引</code>，<code>值越大越好</code>,主要针对于联合索引，有一定的参考意义。</p><h3 id="_12-5-7-ref" tabindex="-1"><a class="header-anchor" href="#_12-5-7-ref"><span>12.5.7 ref</span></a></h3><p>当使用索引列等值查询时，与索引列进行等值匹配的对象信息。比如只是一个常数或者是某个列。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>id <span class="token operator">=</span> s2<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+T+'" alt="image-20240310100526181" tabindex="0" loading="lazy"><figcaption>image-20240310100526181</figcaption></figure><h3 id="_12-5-8-rows" tabindex="-1"><a class="header-anchor" href="#_12-5-8-rows"><span>12.5.8 rows</span></a></h3><p>预估的需要读取的记录条数<code>值越小越好</code></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">&#39;z&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="'+U+'" alt="image-20240310100628691" tabindex="0" loading="lazy"><figcaption>image-20240310100628691</figcaption></figure><h3 id="_12-5-9-filtered" tabindex="-1"><a class="header-anchor" href="#_12-5-9-filtered"><span>12.5.9 filtered</span></a></h3><p>某个表经过搜索条件过滤后剩余记录条数的百分比</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token comment">#对于单表查询来说，这个filtered列的值没什么意义，我们`更关注在连接查询</span>\n <span class="token comment">#中驱动表对应的执行计划记录的filtered值`，它决定了被驱动表要执行的次数(即：rows * filtered)</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">WHERE</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="'+X+'" alt="image-20240310100857719" tabindex="0" loading="lazy"><figcaption>image-20240310100857719</figcaption></figure><h3 id="_12-5-10-extra-☆" tabindex="-1"><a class="header-anchor" href="#_12-5-10-extra-☆"><span>12.5.10 Extra ☆</span></a></h3><p>一些额外的信息.更准确的理解MySQL到底将如何执行给定的查询语句</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token comment">#当查询语句的没有`FROM`子句时将会提示该额外信息</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#查询语句的`WHERE`子句永远为`FALSE`时将会提示该额外信息</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#当我们使用全表扫描来执行对某个表的查询，并且该语句的`WHERE`</span>\n <span class="token comment">#子句中有针对该表的搜索条件时，在`Extra`列中会提示上述额外信息。</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> common_field <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#当使用索引访问来执行对某个表的查询，并且该语句的`WHERE`子句中</span>\n <span class="token comment">#有除了该索引包含的列之外的其他搜索条件时，在`Extra`列中也会提示上述额外信息。</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">AND</span> common_field <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#当查询列表处有`MIN`或者`MAX`聚合函数，但是并没有符合`WHERE`子句中</span>\n <span class="token comment">#的搜索条件的记录时，将会提示该额外信息</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;abcdefg&#39;</span><span class="token punctuation">;</span>\n \n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>key1<span class="token punctuation">)</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;NlPros&#39;</span><span class="token punctuation">;</span> <span class="token comment">#NlPros 是 s1表中key1字段真实存在的数据</span>\n\n\n <span class="token comment">#当我们的查询列表以及搜索条件中只包含属于某个索引的列，也就是在可以</span>\n <span class="token comment">#使用覆盖索引的情况下，在`Extra`列将会提示该额外信息。比方说下边这个查询中只</span>\n <span class="token comment">#需要用到`idx_key1`而不需要回表操作：</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key1<span class="token punctuation">,</span>id <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n \n  <span class="token comment">#有些搜索条件中虽然出现了索引列，但却不能使用到索引</span>\n <span class="token comment">#看课件理解索引条件下推</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">&gt;</span> <span class="token string">&#39;z&#39;</span> <span class="token operator">AND</span> key1 <span class="token operator">LIKE</span> <span class="token string">&#39;%a&#39;</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#在连接查询执行过程中，当被驱动表不能有效的利用索引加快访问速度，MySQL一般会为</span>\n <span class="token comment">#其分配一块名叫`join buffer`的内存块来加快查询速度，也就是我们所讲的`基于块的嵌套循环算法`</span>\n <span class="token comment">#见课件说明</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>common_field <span class="token operator">=</span> s2<span class="token punctuation">.</span>common_field<span class="token punctuation">;</span>\n \n \n <span class="token comment">#当我们使用左（外）连接时，如果`WHERE`子句中包含要求被驱动表的某个列等于`NULL`值的搜索条件，</span>\n <span class="token comment">#而且那个列又是不允许存储`NULL`值的，那么在该表的执行计划的Extra列就会提示`Not exists`额外信息</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>key1 <span class="token operator">=</span> s2<span class="token punctuation">.</span>key1 <span class="token keyword">WHERE</span> s2<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#如果执行计划的`Extra`列出现了`Using intersect(...)`提示，说明准备使用`Intersect`索引</span>\n <span class="token comment">#合并的方式执行查询，括号中的`...`表示需要进行索引合并的索引名称；</span>\n <span class="token comment">#如果出现了`Using union(...)`提示，说明准备使用`Union`索引合并的方式执行查询；</span>\n <span class="token comment">#出现了`Using sort_union(...)`提示，说明准备使用`Sort-Union`索引合并的方式执行查询。</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#当我们的`LIMIT`子句的参数为`0`时，表示压根儿不打算从表中读出任何记录，将会提示该额外信息</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#有一些情况下对结果集中的记录进行排序是可以使用到索引的。</span>\n <span class="token comment">#比如：</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> key1 <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#很多情况下排序操作无法使用到索引，只能在内存中（记录较少的时候）或者磁盘中（记录较多的时候）</span>\n <span class="token comment">#进行排序，MySQL把这种在内存中或者磁盘上进行排序的方式统称为文件排序（英文名：`filesort`）。</span>\n \n <span class="token comment">#如果某个查询需要使用文件排序的方式执行查询，就会在执行计划的`Extra`列中显示`Using filesort`提示</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> s1 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> common_field <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>\n \n \n <span class="token comment">#在许多查询的执行过程中，MySQL可能会借助临时表来完成一些功能，比如去重、排序之类的，比如我们</span>\n <span class="token comment">#在执行许多包含`DISTINCT`、`GROUP BY`、`UNION`等子句的查询过程中，如果不能有效利用索引来完成</span>\n <span class="token comment">#查询，MySQL很有可能寻求通过建立内部的临时表来执行查询。如果查询中使用到了内部的临时表，在执行</span>\n <span class="token comment">#计划的`Extra`列将会显示`Using temporary`提示</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> common_field <span class="token keyword">FROM</span> s1<span class="token punctuation">;</span>\n \n <span class="token comment">#EXPLAIN SELECT DISTINCT key1 FROM s1;</span>\n \n <span class="token comment">#同上。</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> common_field<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> amount <span class="token keyword">FROM</span> s1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> common_field<span class="token punctuation">;</span>\n \n <span class="token comment">#执行计划中出现`Using temporary`并不是一个好的征兆，因为建立与维护临时表要付出很大成本的，所以</span>\n <span class="token comment">#我们`最好能使用索引来替代掉使用临时表`。比如：扫描指定的索引idx_key1即可</span>\n <span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> key1<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> amount <span class="token keyword">FROM</span> s1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> key1<span class="token punctuation">;</span>\n \n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',168)],z={},D=(0,n(66262).A)(z,[["render",function(s,a){return(0,e.uX)(),(0,e.CE)("div",null,F)}]]),C=JSON.parse('{"path":"/MySQL/12%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8.html","title":"十二、性能分析工具的使用","lang":"zh-CN","frontmatter":{"date":"2024-03-28T00:00:00.000Z","category":["数据库"],"tag":["数据库","MySQL"],"editLink":false,"pageview":false,"sticky":true,"star":true,"order":12,"description":"十二、性能分析工具的使用 12.1 数据库服务器的优化步骤 当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。 整个流程划分成了 观察（Show status） 和 行动（Action） 两个部分。字母 S 的部分代表观察（会使 用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。 image-202...","head":[["meta",{"property":"og:url","content":"https://www.yzgc.top/MySQL/12%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8.html"}],["meta",{"property":"og:site_name","content":"鲨瓜"}],["meta",{"property":"og:title","content":"十二、性能分析工具的使用"}],["meta",{"property":"og:description","content":"十二、性能分析工具的使用 12.1 数据库服务器的优化步骤 当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。 整个流程划分成了 观察（Show status） 和 行动（Action） 两个部分。字母 S 的部分代表观察（会使 用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。 image-202..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-05T05:35:13.000Z"}],["meta",{"property":"article:author","content":"鲨瓜"}],["meta",{"property":"article:tag","content":"数据库"}],["meta",{"property":"article:tag","content":"MySQL"}],["meta",{"property":"article:published_time","content":"2024-03-28T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-05T05:35:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"十二、性能分析工具的使用\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-03-28T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-05T05:35:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"鲨瓜\\",\\"url\\":\\"https://www.yzgc.top\\"}]}"]]},"headers":[{"level":2,"title":"12.1 数据库服务器的优化步骤","slug":"_12-1-数据库服务器的优化步骤","link":"#_12-1-数据库服务器的优化步骤","children":[]},{"level":2,"title":"12.2 查看系统性能参数","slug":"_12-2-查看系统性能参数","link":"#_12-2-查看系统性能参数","children":[]},{"level":2,"title":"12.3 统计SQL的查询成本：last_query_cost","slug":"_12-3-统计sql的查询成本-last-query-cost","link":"#_12-3-统计sql的查询成本-last-query-cost","children":[]},{"level":2,"title":"12.4 定位执行慢的SQL：慢查询日志","slug":"_12-4-定位执行慢的sql-慢查询日志","link":"#_12-4-定位执行慢的sql-慢查询日志","children":[{"level":3,"title":"12.4.1 开启/关闭/删除 慢查询日志","slug":"_12-4-1-开启-关闭-删除-慢查询日志","link":"#_12-4-1-开启-关闭-删除-慢查询日志","children":[]},{"level":3,"title":"12.4.2 慢查询日志分析工具：mysqldumpslow","slug":"_12-4-2-慢查询日志分析工具-mysqldumpslow","link":"#_12-4-2-慢查询日志分析工具-mysqldumpslow","children":[]}]},{"level":2,"title":"12.5 分析查询语句","slug":"_12-5-分析查询语句","link":"#_12-5-分析查询语句","children":[{"level":3,"title":"12.5.1 table","slug":"_12-5-1-table","link":"#_12-5-1-table","children":[]},{"level":3,"title":"12.5.2 id","slug":"_12-5-2-id","link":"#_12-5-2-id","children":[]},{"level":3,"title":"12.5.3 select_type","slug":"_12-5-3-select-type","link":"#_12-5-3-select-type","children":[]},{"level":3,"title":"12.5.4 type△","slug":"_12-5-4-type△","link":"#_12-5-4-type△","children":[]},{"level":3,"title":"12.5.5 possible_keys和key","slug":"_12-5-5-possible-keys和key","link":"#_12-5-5-possible-keys和key","children":[]},{"level":3,"title":"12.5.6  key_len ☆","slug":"_12-5-6-key-len-☆","link":"#_12-5-6-key-len-☆","children":[]},{"level":3,"title":"12.5.7  ref","slug":"_12-5-7-ref","link":"#_12-5-7-ref","children":[]},{"level":3,"title":"12.5.8 rows","slug":"_12-5-8-rows","link":"#_12-5-8-rows","children":[]},{"level":3,"title":"12.5.9 filtered","slug":"_12-5-9-filtered","link":"#_12-5-9-filtered","children":[]},{"level":3,"title":"12.5.10 Extra ☆","slug":"_12-5-10-extra-☆","link":"#_12-5-10-extra-☆","children":[]}]}],"git":{"createdTime":1712295313000,"updatedTime":1712295313000,"contributors":[{"name":"“杨照光”","email":"“yangzhaoguang@ciictec.com”","commits":1}]},"readingTime":{"minutes":15.66,"words":4698},"filePathRelative":"MySQL/12性能分析工具的使用.md","localizedDate":"2024年3月28日","excerpt":"\\n<h2>12.1 数据库服务器的优化步骤</h2>\\n<p>当我们遇到数据库调优问题的时候，该如何思考呢？这里把思考的流程整理成下面这张图。</p>\\n<p>整个流程划分成了 <code>观察（Show status）</code> 和 <code>行动（Action）</code> 两个部分。字母 S 的部分代表观察（会使 用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。</p>\\n<figure><figcaption>image-20240309204147339</figcaption></figure>\\n<figure><figcaption>image-20240309204157480</figcaption></figure>","autoDesc":true}')}}]);